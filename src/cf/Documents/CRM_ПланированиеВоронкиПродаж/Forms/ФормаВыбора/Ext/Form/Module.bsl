
///////////////////////////////////////////////////////////////////////////////
// ОБЩИЕ ПРОЦЕДУРЫ И ФУНКЦИИ

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ

&НаКлиенте
Процедура ПолеБыстрогоОтбораПриИзмененииОбщий(Элемент)
	
	CRM_ОбщегоНазначенияКлиентСервер.БыстрыйОтборПрименитьОтборКСписку(Список, Элемент, ЭтотОбъект);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// КОМАНДЫ

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриЗагрузкеДанныхИзНастроекНаСервере(Настройки)
	ЗначениеНастройки = Настройки.Получить("ПолеБыстрогоОтбора_Статус");
	Если ЗначениеЗаполнено(ЗначениеНастройки) Тогда
		CRM_ОбщегоНазначенияКлиентСервер.ИзменитьЭлементОтбораСписка(Список, "Статус", ЗначениеНастройки, Истина);
	КонецЕсли;
	ЗначениеНастройки = Настройки.Получить("ПолеБыстрогоОтбора_Автор");
	Если ЗначениеЗаполнено(ЗначениеНастройки) Тогда
		CRM_ОбщегоНазначенияКлиентСервер.ИзменитьЭлементОтбораСписка(Список, "Автор", ЗначениеНастройки, Истина);
	КонецЕсли;
	ЗначениеНастройки = Настройки.Получить("ПолеБыстрогоОтбора_ПериодПланирования");
	Если ЗначениеЗаполнено(ЗначениеНастройки) Тогда
		CRM_ОбщегоНазначенияКлиентСервер.ИзменитьЭлементОтбораСписка(Список, "ПериодПланирования", ЗначениеНастройки, Истина);
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если НЕ CRM_ЛицензированиеСервер.ПодсистемаCRMИспользуется() Тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru = 'Невозможно открыть форму выбора планов. Подсистема 1С:CRM не используется!'"));
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
	CRM_ЛицензированиеСервер.ПолучитьЗащищеннуюОбработку().ПриСозданиеНаСервере(ЭтотОбъект, Отказ, СтандартнаяОбработка);
	
	ПланироватьПродажи = ПолучитьФункциональнуюОпцию("CRM_ПланироватьПродажи");
	Если ПланироватьПродажи <> Истина Тогда
		Отказ = Истина;
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(CRM_КлиентыСервер.ТекстСообщенияОНевозможностиПланирования());
		Возврат;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти
