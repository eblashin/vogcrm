#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда


// СтандартныеПодсистемы.ВерсионированиеОбъектов
// Определяет настройки объекта для подсистемы ВерсионированиеОбъектов.
//
// Параметры:
// Настройки - Структура - настройки подсистемы.
Процедура ПриОпределенииНастроекВерсионированияОбъектов(Настройки) Экспорт
КонецПроцедуры
// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов

// Инициализирует таблицы значений, содержащие данные табличных частей документа.
// Таблицы значений сохраняет в свойствах структуры "ДополнительныеСвойства".
//
Процедура ИнициализироватьДанныеДокумента(ДокументСсылка, СтруктураДополнительныеСвойства) Экспорт
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	Планы.Ссылка.УдалитьДатаНачалаДействия		КАК Период,
	//|	Планы.Ссылка.ПериодПланирования.ДатаНачала КАК Период,
	|	Планы.Ссылка						КАК Регистратор,
	|	Планы.Ссылка.ВоронкаПродаж			КАК ВоронкаПродаж,
	|	Планы.Ссылка.ОбъектПланирования		КАК ОбъектПланирования,
	|	
	|	ВЫБОР
	|		КОГДА Планы.Ссылка.Статус = ЗНАЧЕНИЕ(Перечисление.CRM_СтатусыПланов.Утвержден) ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК Активность,
	|	
	|	ВЫБОР
	|		КОГДА Планы.Ссылка.ОбъектПланирования = ЗНАЧЕНИЕ(Перечисление.CRM_ОбъектыПланированияВоронкиПродаж.Менеджер) ТОГДА Планы.Ссылка.Менеджер
	|		КОГДА Планы.Ссылка.ОбъектПланирования = ЗНАЧЕНИЕ(Перечисление.CRM_ОбъектыПланированияВоронкиПродаж.Подразделение) ТОГДА Планы.Ссылка.Подразделение
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК ЗначениеОбъектаПланирования,
	|	
	|	Планы.Этап КАК Этап,
	|	
	|	СУММА(Планы.Количество)			КАК Количество,
	|	СУММА(Планы.Сумма)				КАК Сумма,
	|	СУММА(Планы.СуммаПотенциальная)	КАК СуммаПотенциальная
	|	
	|ИЗ
	|	
	|	Документ.CRM_ПланированиеВоронкиПродаж.Планы КАК Планы
	|	
	|ГДЕ
	|	
	|	Планы.Ссылка = &Ссылка
	|	
	|СГРУППИРОВАТЬ ПО
	|	
	|	Планы.Ссылка,
	|	Планы.Этап
	|";
	
	Запрос.УстановитьПараметр("Ссылка", ДокументСсылка);
	
	СтруктураДополнительныеСвойства.ТаблицыДляДвижений.Вставить("ТаблицаПланирование", Запрос.Выполнить().Выгрузить());
КонецПроцедуры

#КонецЕсли