
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	
	CRM_ОбщегоНазначенияСервер.ЗаполнитьШапкуДокумента(ЭтотОбъект, ДанныеЗаполнения);
	ЗаполнитьРеквизитыПоУмолчанию();
	
	//+вог 	
	Если НЕ ЗначениеЗаполнено(Проект) И ТипЗнч(ДанныеЗаполнения) = Тип("СправочникСсылка.Проекты") Тогда
		Проект = ДанныеЗаполнения;		
	КонецЕсли; 	
	//-вог
	
	ТипДанныхЗаполнения = ТипЗнч(ДанныеЗаполнения);
	
	Если ТипДанныхЗаполнения = Тип("Структура") Тогда
		ЗаполнитьЗначенияСвойств(ЭтотОбъект, ДанныеЗаполнения);

	КонецЕсли;
	
КонецПроцедуры

Процедура ПриКопировании(ОбъектКопирования)
	
	// Очистим табличные части и реквизиты.
	Смещения.Очистить();
	Описание	  = "";
	Результат	  = "";
	ДатаЗакрытия  = "";
	Автор 		  = CRM_ОбщегоНазначенияСервер.ТекущийПользователь();

	ЗаполнитьРеквизитыПоУмолчанию();
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	ЗаполнитьСписокУчастников();
	
КонецПроцедуры

#КонецОбласти

#Область ИнициализацияИЗаполнение

Процедура ЗаполнитьСписокУчастников() Экспорт
	
	СписокУчастников = "";
	Для Каждого Участник Из ПользователиЭтапа Цикл
		СписокУчастников = СписокУчастников + ?(СписокУчастников = "", "", "; ") + Участник.Пользователь;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура ЗаполнитьРеквизитыПоУмолчанию()
	
	Статус = Перечисления.CRM_СтатусыКонтрольныхТочек.Запланирована;
	Дата   = ТекущаяДатаСеанса();

КонецПроцедуры

#КонецОбласти

#КонецЕсли