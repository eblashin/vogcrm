#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт //Павелко, CRM - 42, 25.12.2019
	
	ПараметрыВывода.ДоступнаПечатьПоКомплектно = Истина;
	
	Если УправлениеПечатью.НужноПечататьМакет(КоллекцияПечатныхФорм, "ПланКомандировки") Тогда
		УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(
		КоллекцияПечатныхФорм, "ПланКомандировки", "План командировки", ПечатьПланаКомандировки(МассивОбъектов, ОбъектыПечати), ОбъектыПечати, "Документ.вогКомандировка.ПФ_MXL_ПланКомандировки");
	//--> VOG Турский Сергей 07.12.2020 16:20:08 ID заявки: CRM 1067.
	ИначеЕсли УправлениеПечатью.НужноПечататьМакет(КоллекцияПечатныхФорм, "ЗаявлениеНаВыдачуДенежныхСредств") Тогда
		УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(
		КоллекцияПечатныхФорм, "ЗаявлениеНаВыдачуДенежныхСредств", "Заявление на выдачу денеж. средств", 
		ПечатьЗаявлениеНаВыдачуДенежныхСредств(МассивОбъектов, ОбъектыПечати, ПараметрыПечати), ОбъектыПечати, "Документ.вогКомандировка.ПФ_MXL_ЗаявлениеНаВыдачуДенежныхСредств");
	//<-- VOG Турский Сергей 07.12.2020 16:20:10 ID заявки: CRM 1067.
	КонецЕсли;
	
КонецПроцедуры





Функция ПечатьПланаКомандировки(МассивОбъектов, ОбъектыПечати) //Павелко, CRM - 42, 25.12.2019

	
	
	Макет 	= Документы.вогКомандировка.ПолучитьМакет("ПФ_MXL_ПланКомандировки");
	
	ТабДок 	= Новый ТабличныйДокумент;
	ТабДок.АвтоМасштаб = Истина;
	
	ПервыйДокумент = Истина;
	
	ОбластьЗаголовок   		= Макет.ПолучитьОбласть("Заголовок");
	ОбластьСотрудник  		= Макет.ПолучитьОбласть("Сотрудник");
	ОбластьДатаЗадачи		= Макет.ПолучитьОбласть("ДатаЗадачи");
	ОбластьГород			= Макет.ПолучитьОбласть("Город");
	ОбластьАдрес			= Макет.ПолучитьОбласть("Адрес");
	ОбластьКлиент			= Макет.ПолучитьОбласть("Клиент");
	ОбластьЗадача  			= Макет.ПолучитьОбласть("Задача");
	ОбластьОписаниеЗадачи 	= Макет.ПолучитьОбласть("ОписаниеЗадачи");
	ОбластьПовестка  		= Макет.ПолучитьОбласть("Повестка");
	ОбластьКомментарий 		= Макет.ПолучитьОбласть("Комментарий");
	ОбластьПеремещение 		= Макет.ПолучитьОбласть("Перемещение");
		
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	вогКомандировкаЗадачи.Ссылка.ВремяНачала КАК ДатаНачала,
		|	вогКомандировкаЗадачи.Ссылка.ВремяОкончания КАК ДатаОкончания,
		|	вогКомандировкаЗадачи.Город КАК Город,
		|	вогКомандировкаЗадачи.АдресОфиса КАК Адрес,
		|	вогКомандировкаЗадачи.ВремяНачала КАК ВремяНачала,
		|	вогКомандировкаЗадачи.ВремяОкончания КАК ВремяОкончания,
		|	вогКомандировкаЗадачи.Клиент КАК Клиент,
		|	вогКомандировкаЗадачи.ТорговаяТочка КАК ТорговаяТочка,
		|	вогКомандировкаЗадачи.Приоритет КАК Приоритет,
		|	ВЫБОР
		|		КОГДА вогКомандировкаЗадачи.Задача ССЫЛКА Задача.ЗадачаИсполнителя
		|			ТОГДА ВЫРАЗИТЬ(вогКомандировкаЗадачи.Задача КАК Задача.ЗадачаИсполнителя).БизнесПроцесс.Описание
		|		ИНАЧЕ ВЫРАЗИТЬ(вогКомандировкаЗадачи.Задача КАК Документ.CRM_Мероприятие).Описание
		|	КОНЕЦ КАК ОписаниеЗадачи,
		|	вогКомандировкаЗадачи.ОжидаемыйРезультат КАК ОжидаемыйРезультат,
		|	вогКомандировкаЗадачи.Комментарий КАК Комментарий,
		|	вогКомандировкаЗадачи.Сотрудник КАК Сотрудник,
		|	вогКомандировкаЗадачи.Ссылка КАК ДокументКомандировки,
		|	вогКомандировкаЗадачи.Ссылка.Номер КАК Номер,
		|	вогКомандировкаЗадачи.Ссылка.Дата КАК Дата,
		|	ВЫБОР
		|		КОГДА вогКомандировкаЗадачи.Задача ССЫЛКА Задача.ЗадачаИсполнителя
		|			ТОГДА ВЫРАЗИТЬ(вогКомандировкаЗадачи.Задача КАК Задача.ЗадачаИсполнителя).Наименование
		|		ИНАЧЕ ВЫРАЗИТЬ(вогКомандировкаЗадачи.Задача КАК Документ.CRM_Мероприятие).Тема
		|	КОНЕЦ КАК ТемаЗадачи,
		|	ЛОЖЬ КАК ЭтоПеремещение,
		|	НАЧАЛОПЕРИОДА(вогКомандировкаЗадачи.ВремяНачала, ДЕНЬ) КАК ДатаЗадачи,
		|	вогКомандировкаЗадачи.Задача КАК Задача
		|ИЗ
		|	Документ.вогКомандировка.Задачи КАК вогКомандировкаЗадачи
		|ГДЕ
		|	вогКомандировкаЗадачи.Ссылка В(&МассивОбъектов)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	НЕОПРЕДЕЛЕНО,
		|	НЕОПРЕДЕЛЕНО,
		|	НЕОПРЕДЕЛЕНО,
		|	НЕОПРЕДЕЛЕНО,
		|	СобытияПланировщика.ДатаНачала,
		|	СобытияПланировщика.ДатаОкончания,
		|	НЕОПРЕДЕЛЕНО,
		|	НЕОПРЕДЕЛЕНО,
		|	НЕОПРЕДЕЛЕНО,
		|	СобытияПланировщика.Описание,
		|	НЕОПРЕДЕЛЕНО,
		|	"""",
		|	СобытияПланировщика.Сотрудник,
		|	СобытияПланировщика.Объект,
		|	НЕОПРЕДЕЛЕНО,
		|	НЕОПРЕДЕЛЕНО,
		|	НЕОПРЕДЕЛЕНО,
		|	ИСТИНА,
		|	НАЧАЛОПЕРИОДА(СобытияПланировщика.ДатаНачала, ДЕНЬ),
		|	НЕОПРЕДЕЛЕНО
		|ИЗ
		|	РегистрСведений.СобытияПланировщика КАК СобытияПланировщика
		|ГДЕ
		|	СобытияПланировщика.Объект В(&МассивОбъектов)
		|	И СобытияПланировщика.ЭтоДекорация = ИСТИНА
		|
		|УПОРЯДОЧИТЬ ПО
		|	ВремяНачала,
		|	ВремяОкончания
		|ИТОГИ
		|	МАКСИМУМ(ДатаНачала),
		|	МАКСИМУМ(ДатаОкончания),
		|	МАКСИМУМ(Номер),
		|	МАКСИМУМ(Дата)
		|ПО
		|	ДокументКомандировки,
		|	Сотрудник";
	
	Запрос.УстановитьПараметр("МассивОбъектов", МассивОбъектов);
	
	ВыборкаДокументов = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	Пока ВыборкаДокументов.Следующий() Цикл
		
		Если Не ПервыйДокумент Тогда
			ТабДок.ВывестиГоризонтальныйРазделительСтраниц();
		КонецЕсли;
		ПервыйДокумент = Ложь;
		
		НомерСтрокиНачало = ТабДок.ВысотаТаблицы + 1;
				
		ВыборкаСотрудники = ВыборкаДокументов.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		
		Пока ВыборкаСотрудники.Следующий() Цикл
			
			ПредыдущаяДатаЗадачи 	= Неопределено;
			ПредыдущийГород 		= Неопределено;
			ПредыдущийАдрес 		= Неопределено;
			ПредыдущийКлиент 		= Неопределено;
			ПредыдущаяТорговаяТочка = Неопределено;
			
			ОбластьЗаголовок.Параметры.Номер 			= ПрефиксацияОбъектовКлиентСервер.ПолучитьНомерНаПечать(ВыборкаДокументов.Номер, Истина, Ложь);
			ОбластьЗаголовок.Параметры.Дата 			= Формат(ВыборкаДокументов.Дата, "ДФ=dd.MM.yyyy");
			ОбластьЗаголовок.Параметры.ДатаНачала 		= Формат(ВыборкаДокументов.ДатаНачала, "ДФ=dd.MM.yyyy");
			ОбластьЗаголовок.Параметры.ДатаОкончания 	= Формат(ВыборкаДокументов.ДатаОкончания, "ДФ=dd.MM.yyyy");
			
			ТабДок.Вывести(ОбластьЗаголовок);
			
			ОбластьСотрудник.Параметры.Заполнить(ВыборкаСотрудники);
			
			ТабДок.Вывести(ОбластьСотрудник);
			
			ВыборкаЗадачи = ВыборкаСотрудники.Выбрать();
																				
			Пока ВыборкаЗадачи.Следующий() Цикл
				
				Если Не ПредыдущаяДатаЗадачи = ВыборкаЗадачи.ДатаЗадачи Тогда
					ОбластьДатаЗадачи.Параметры.ДатаЗадачи = Формат(ВыборкаЗадачи.ДатаЗадачи, "ДФ=dd.MM.yyyy");
					ТабДок.Вывести(ОбластьДатаЗадачи);
				КонецЕсли;	
				
				Если ВыборкаЗадачи.ЭтоПеремещение Тогда
					
					ОбластьПеремещение.Параметры.ОписаниеЗадачи = ВыборкаЗадачи.ОписаниеЗадачи;					
					ОбластьПеремещение.Параметры.ВремяНачала 	= Формат(ВыборкаЗадачи.ВремяНачала, "ДФ=HH:mm");
					ОбластьПеремещение.Параметры.ВремяОкончания = Формат(ВыборкаЗадачи.ВремяОкончания, "ДФ=HH:mm");
					
					ТабДок.Вывести(ОбластьПеремещение);
					
				Иначе
									
					Если Не ПредыдущийГород = ВыборкаЗадачи.Город Тогда
						ОбластьГород.Параметры.Город = ВыборкаЗадачи.Город;
						ТабДок.Вывести(ОбластьГород);
					КонецЕсли;
										
					Если Не ПредыдущийКлиент = ВыборкаЗадачи.Клиент Или Не ПредыдущаяТорговаяТочка = ВыборкаЗадачи.ТорговаяТочка Тогда
						
						МассивЗначенийКлиента = Новый Массив;
				
						Если ЗначениеЗаполнено(ВыборкаЗадачи.Клиент) Тогда
							МассивЗначенийКлиента.Добавить(ВыборкаЗадачи.Клиент);
						КонецЕсли;
						
						Если ЗначениеЗаполнено(ВыборкаЗадачи.ТорговаяТочка) Тогда
							МассивЗначенийКлиента.Добавить(ВыборкаЗадачи.ТорговаяТочка);
						КонецЕсли;
					
						ОбластьКлиент.Параметры.Клиент = СтрСоединить(МассивЗначенийКлиента, ", ");
						ТабДок.Вывести(ОбластьКлиент);
						
					КонецЕсли;	
					
					Если Не ПредыдущийАдрес = ВыборкаЗадачи Тогда
						ОбластьАдрес.Параметры.Адрес =  ВыборкаЗадачи.Адрес;
						ТабДок.Вывести(ОбластьАдрес);
					КонецЕсли;
					
					ОбластьЗадача.Параметры.Заполнить(ВыборкаЗадачи);
					
					ОбластьЗадача.Параметры.ВремяНачала 	= Формат(ВыборкаЗадачи.ВремяНачала, "ДФ=HH:mm");
					ОбластьЗадача.Параметры.ВремяОкончания 	= Формат(ВыборкаЗадачи.ВремяОкончания, "ДФ=HH:mm");
					
					ТабДок.Вывести(ОбластьЗадача);
					
					Если ТипЗнч(ВыборкаЗадачи.Задача) = Тип("ДокументСсылка.CRM_Мероприятие") Тогда
						
						Для Каждого Строка Из ВыборкаЗадачи.Задача.вогПрограмма Цикл
							ОбластьПовестка.Параметры.Повестка = "" + Строка.НомерПункта + ". " + Строка.Содержание;
							ТабДок.Вывести(ОбластьПовестка);
						КонецЦикла;
											
					Иначе
						ОбластьОписаниеЗадачи.Параметры.ОписаниеЗадачи = ВыборкаЗадачи.ОписаниеЗадачи;
						ТабДок.Вывести(ОбластьОписаниеЗадачи);
					КонецЕсли;	
					
					ТабДок.Вывести(ОбластьКомментарий);
					
					ПредыдущийГород 		= ВыборкаЗадачи.Город;
					ПредыдущийАдрес 		= ВыборкаЗадачи.Адрес;
					ПредыдущийКлиент 		= ВыборкаЗадачи.Клиент;
					ПредыдущаяТорговаяТочка = ВыборкаЗадачи.ТорговаяТочка;
					
				КонецЕсли;	
				
				ПредыдущаяДатаЗадачи 	= ВыборкаЗадачи.ДатаЗадачи;
				
			КонецЦикла;

			
			ТабДок.ВывестиГоризонтальныйРазделительСтраниц();
			
		КонецЦикла;	
		
		УправлениеПечатью.ЗадатьОбластьПечатиДокумента(ТабДок, НомерСтрокиНачало, ОбъектыПечати, ВыборкаДокументов.ДокументКомандировки);
		
	КонецЦикла;
	
	Возврат ТабДок;
	
КонецФункции	

Функция ПечатьЗаявлениеНаВыдачуДенежныхСредств(МассивОбъектов, ОбъектыПечати, ПараметрыПечати) //--> VOG Турский Сергей 07.12.2020 13:18:48 ID заявки: CRM 1067. 
	
	ТабДокумент 									= Новый ТабличныйДокумент;
	
	СотрудникОтбор 									= Неопределено;
	НомерСтроки 									= 0;
	
	Если НЕ МассивОбъектов.Количество() = 1 
		ИЛИ НЕ ПараметрыПечати.Свойство("СотрудникОтбор", СотрудникОтбор)
		ИЛИ НЕ ЗначениеЗаполнено(СотрудникОтбор) 
		ИЛИ НЕ ПараметрыПечати.Свойство("НомерСтроки", НомерСтроки)
		ИЛИ НЕ ЗначениеЗаполнено(НомерСтроки) Тогда
		
		Возврат ТабДокумент;
		
	КонецЕсли;
	
	НомерСтрокиНачало 								= ТабДокумент.ВысотаТаблицы + 1;
	
	ВалютаРегламентированногоУчета 					= Константы.ВалютаРегламентированногоУчета.Получить();
	ТекущийДокумент									= МассивОбъектов[0];
	
	Если НЕ ЗначениеЗаполнено(ТекущийДокумент) Тогда
		Возврат ТабДокумент;
	КонецЕсли;
	
	ТабДокумент.АвтоМасштаб 						= Истина;
	
	Макет 											= Документы.вогКомандировка.ПолучитьМакет("ПФ_MXL_ЗаявлениеНаВыдачуДенежныхСредств");
	
	ОбластьШапка   									= Макет.ПолучитьОбласть("Шапка");
	ОбластьЗаголовок   								= Макет.ПолучитьОбласть("Заголовок");
	ОбластьТаблица1   								= Макет.ПолучитьОбласть("Таблица1");
	ОбластьТаблица2   								= Макет.ПолучитьОбласть("Таблица2");
	//--> VOG Турский Сергей 23.12.2020 15:03:28 ID заявки: DEV-21.
	ОбластьТаблица2ДополнительныеРасходы   			= Макет.ПолучитьОбласть("Таблица2ДополнительныеРасходы");
	ОбластьИтогоКВыдаче								= Макет.ПолучитьОбласть("ИтогоКВыдаче");
	//<-- VOG Турский Сергей 23.12.2020 15:03:28 ID заявки: DEV-21.
	ОбластьПодвал   								= Макет.ПолучитьОбласть("Подвал");
	
	Запрос 											= Новый Запрос;
	//--> VOG Турский Сергей 25.12.2020 16:39:27 ID заявки: DEV-21.
	// -
	//Запрос.Текст 									= 
	//"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	//|	вогКомандировкаКомандированныеСотрудники.Сотрудник.Подразделение.Организация КАК Организация
	//|ПОМЕСТИТЬ ВТ_СотрудникиВодитель
	//|ИЗ
	//|	Документ.вогКомандировка.КомандированныеСотрудники КАК вогКомандировкаКомандированныеСотрудники
	//|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.вогЭтапыСогласованияКомандировок КАК вогЭтапыСогласованияКомандировок
	//|		ПО вогКомандировкаКомандированныеСотрудники.Ссылка = вогЭтапыСогласованияКомандировок.Командировка
	//|			И (&ЭтоВодитель)
	//|			И (НЕ вогКомандировкаКомандированныеСотрудники.Сотрудник = &Водитель)
	//|ГДЕ
	//|	НЕ вогЭтапыСогласованияКомандировок.Этап В (&ЭтапыНЕВыводить)
	//|	И вогКомандировкаКомандированныеСотрудники.Ссылка = &ТекущийДокумент
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	//|	вогКомандировкаКомандированныеСотрудники.Ссылка КАК Командировка,
	//|	МИНИМУМ(вогКомандировкаКомандированныеСотрудники.НомерСтроки) КАК НомерСтроки,
	//|	вогКомандировкаКомандированныеСотрудники.Сотрудник КАК Сотрудник,
	//|	вогКомандировкаКомандированныеСотрудники.Сотрудник.Наименование КАК СотрудникФИОПолностьюИП,
	//|	вогКомандировкаКомандированныеСотрудники.Сотрудник.CRM_ДолжностнаяПозиция КАК СотрудникДолжностьИП,
	//|	вогКомандировкаКомандированныеСотрудники.Сотрудник.ФизическоеЛицо.Пол КАК СотрудникПол,
	//|	ВЫБОР
	//|		КОГДА вогКомандировкаКомандированныеСотрудники.Сотрудник = &Водитель
	//|			ТОГДА ВТ_СотрудникиВодитель.Организация
	//|		ИНАЧЕ вогКомандировкаКомандированныеСотрудники.Сотрудник.Подразделение.Организация
	//|	КОНЕЦ КАК Организация
	//|ПОМЕСТИТЬ ВТ_Сотрудники
	//|ИЗ
	//|	Документ.вогКомандировка.КомандированныеСотрудники КАК вогКомандировкаКомандированныеСотрудники
	//|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.вогЭтапыСогласованияКомандировок КАК вогЭтапыСогласованияКомандировок
	//|		ПО вогКомандировкаКомандированныеСотрудники.Ссылка = вогЭтапыСогласованияКомандировок.Командировка
	//|		ПОЛНОЕ СОЕДИНЕНИЕ ВТ_СотрудникиВодитель КАК ВТ_СотрудникиВодитель
	//|		ПО (ИСТИНА)
	//|ГДЕ
	//|	НЕ вогЭтапыСогласованияКомандировок.Этап В (&ЭтапыНЕВыводить)
	//|	И вогКомандировкаКомандированныеСотрудники.Ссылка = &ТекущийДокумент
	//|	И вогКомандировкаКомандированныеСотрудники.Сотрудник = &СотрудникОтбор
	//|
	//|СГРУППИРОВАТЬ ПО
	//|	вогКомандировкаКомандированныеСотрудники.Сотрудник,
	//|	вогКомандировкаКомандированныеСотрудники.Сотрудник.Наименование,
	//|	вогКомандировкаКомандированныеСотрудники.Сотрудник.CRM_ДолжностнаяПозиция,
	//|	вогКомандировкаКомандированныеСотрудники.Сотрудник.ФизическоеЛицо.Пол,
	//|	вогКомандировкаКомандированныеСотрудники.Ссылка,
	//|	ВЫБОР
	//|		КОГДА вогКомандировкаКомандированныеСотрудники.Сотрудник = &Водитель
	//|			ТОГДА ВТ_СотрудникиВодитель.Организация
	//|		ИНАЧЕ вогКомандировкаКомандированныеСотрудники.Сотрудник.Подразделение.Организация
	//|	КОНЕЦ
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	//|	""Гостиница"" КАК СтатьяРасхода,
	//|	вогКомандировкаРасходыПроживание.Стоимость КАК Сумма
	//|ПОМЕСТИТЬ ВТ_ДляТаблицы2
	//|ИЗ
	//|	Документ.вогКомандировка.РасходыПроживание КАК вогКомандировкаРасходыПроживание
	//|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	//|		ПО вогКомандировкаРасходыПроживание.Ссылка = ВТ_Сотрудники.Командировка
	//|			И (вогКомандировкаРасходыПроживание.Сотрудник = ВТ_Сотрудники.Сотрудник
	//|				ИЛИ вогКомандировкаРасходыПроживание.Сотрудник = &ПустойСотрудник
	//|					И &НомерСтроки = 1)
	//|ГДЕ
	//|	вогКомандировкаРасходыПроживание.ВыдатьПодотчет
	//|
	//|ОБЪЕДИНИТЬ ВСЕ
	//|
	//|ВЫБРАТЬ
	//|	""Суточные"",
	//|	вогКомандировкаКомандированныеСотрудники.Сумма
	//|ИЗ
	//|	Документ.вогКомандировка.КомандированныеСотрудники КАК вогКомандировкаКомандированныеСотрудники
	//|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	//|		ПО вогКомандировкаКомандированныеСотрудники.Ссылка = ВТ_Сотрудники.Командировка
	//|			И (вогКомандировкаКомандированныеСотрудники.Сотрудник = ВТ_Сотрудники.Сотрудник
	//|				ИЛИ вогКомандировкаКомандированныеСотрудники.Сотрудник = &ПустойСотрудник
	//|					И &НомерСтроки = 1)
	//|
	//|ОБЪЕДИНИТЬ ВСЕ
	//|
	//|ВЫБРАТЬ
	//|	ВЫБОР
	//|		КОГДА вогКомандировкаДополнительныеРасходы.ВидРасхода В (&ВидРасходаМобильнаяСвязь)
	//|			ТОГДА ""СотоваяСвязь""
	//|		КОГДА вогКомандировкаДополнительныеРасходы.ВидРасхода В (&ВидРасходаПлатнаяДорогаСтоянка)
	//|			ТОГДА ""ПроездСтоянка""
	//|		КОГДА вогКомандировкаДополнительныеРасходы.ВидРасхода В (&ВидРасходаПрочее)
	//|			ТОГДА ""Прочие""
	//|		ИНАЧЕ """"
	//|	КОНЕЦ,
	//|	вогКомандировкаДополнительныеРасходы.Сумма
	//|ИЗ
	//|	Документ.вогКомандировка.ДополнительныеРасходы КАК вогКомандировкаДополнительныеРасходы
	//|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	//|		ПО вогКомандировкаДополнительныеРасходы.Ссылка = ВТ_Сотрудники.Командировка
	//|			И (вогКомандировкаДополнительныеРасходы.Сотрудник = ВТ_Сотрудники.Сотрудник
	//|				ИЛИ вогКомандировкаДополнительныеРасходы.Сотрудник = &ПустойСотрудник
	//|					И &НомерСтроки = 1)
	//|ГДЕ
	//|	вогКомандировкаДополнительныеРасходы.ВыдатьПодотчет
	//|	И вогКомандировкаДополнительныеРасходы.ВидРасхода В(&ВидыРасходовОтбор)
	//|
	//|ОБЪЕДИНИТЬ ВСЕ
	//|
	//|ВЫБРАТЬ
	//|	ВЫБОР
	//|		КОГДА вогКомандировкаРасходыПроезд.ВидТранспорта В (&ВидТранспортаАрендаТакси)
	//|			ТОГДА ""АрендаТакси""
	//|		КОГДА вогКомандировкаРасходыПроезд.ВидТранспорта В (&ВидТранспортаПроездСтоянка)
	//|			ТОГДА ""ПроездСтоянка""
	//|		ИНАЧЕ """"
	//|	КОНЕЦ,
	//|	вогКомандировкаРасходыПроезд.Стоимость
	//|ИЗ
	//|	Документ.вогКомандировка.РасходыПроезд КАК вогКомандировкаРасходыПроезд
	//|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	//|		ПО вогКомандировкаРасходыПроезд.Ссылка = ВТ_Сотрудники.Командировка
	//|			И (вогКомандировкаРасходыПроезд.Сотрудник = ВТ_Сотрудники.Сотрудник
	//|				ИЛИ вогКомандировкаРасходыПроезд.Сотрудник = &ПустойСотрудник
	//|					И &НомерСтроки = 1)
	//|ГДЕ
	//|	вогКомандировкаРасходыПроезд.ВыдатьПодотчет
	//|	И вогКомандировкаРасходыПроезд.ВидТранспорта В(&ВидТранспортаОтбор)
	//|
	//|ОБЪЕДИНИТЬ ВСЕ
	//|
	//|ВЫБРАТЬ
	//|	""Представительские"",
	//|	ВЫРАЗИТЬ(вогКомандировкаЗадачи.Задача КАК Документ.CRM_Мероприятие).ПредставительскиеРасходы
	//|ИЗ
	//|	Документ.вогКомандировка.Задачи КАК вогКомандировкаЗадачи
	//|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	//|		ПО вогКомандировкаЗадачи.Ссылка = ВТ_Сотрудники.Командировка
	//|			И (&НомерСтроки = 1)
	//|			И (вогКомандировкаЗадачи.Задача ССЫЛКА Документ.CRM_Мероприятие)
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ
	//|	ВТ_ДляТаблицы2.СтатьяРасхода КАК СтатьяРасхода,
	//|	СУММА(ВТ_ДляТаблицы2.Сумма) КАК Сумма
	//|ИЗ
	//|	ВТ_ДляТаблицы2 КАК ВТ_ДляТаблицы2
	//|
	//|СГРУППИРОВАТЬ ПО
	//|	ВТ_ДляТаблицы2.СтатьяРасхода
	//|ИТОГИ
	//|	СУММА(Сумма)
	//|ПО
	//|	ОБЩИЕ
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 1
	//|	ЕСТЬNULL(вогОтветственныеЛицаОрганизаций.Владелец.НаименованиеСокращенное, """") КАК ОрганизацияНаименование,
	//|	ЕСТЬNULL(вогОтветственныеЛицаОрганизаций.Должность, """") КАК РуководительДолжностьИП,
	//|	ПРЕДСТАВЛЕНИЕССЫЛКИ(ЕСТЬNULL(вогОтветственныеЛицаОрганизаций.ФизическоеЛицо, &ПустоеФЛ)) КАК РуководительФИОПолностьюИП,
	//|	ЕСТЬNULL(вогОтветственныеЛицаОрганизаций.ФизическоеЛицо.Пол, &ПустойПолФЛ) КАК РуководительПол,
	//|	ВТ_Сотрудники.НомерСтроки КАК НомерСтроки,
	//|	ВТ_Сотрудники.СотрудникФИОПолностьюИП КАК СотрудникФИОПолностьюИП,
	//|	ВТ_Сотрудники.СотрудникДолжностьИП КАК СотрудникДолжностьИП,
	//|	ВТ_Сотрудники.СотрудникПол КАК СотрудникПол,
	//|	ВТ_Сотрудники.Командировка.ВремяНачала КАК ВремяНачала,
	//|	ВТ_Сотрудники.Командировка.ВремяОкончания КАК ВремяОкончания
	//|ИЗ
	//|	ВТ_Сотрудники КАК ВТ_Сотрудники
	//|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.вогОтветственныеЛицаОрганизаций КАК вогОтветственныеЛицаОрганизаций
	//|		ПО (вогОтветственныеЛицаОрганизаций.Владелец = ВТ_Сотрудники.Организация)
	//|			И (ВЫБОР
	//|				КОГДА ВТ_Сотрудники.Организация.ИНН = &ИННВОГЮг
	//|					ТОГДА вогОтветственныеЛицаОрганизаций.Должность = &ДолжностьЗамГенеральногоДиректораПоРазвитию
	//|				ИНАЧЕ ИСТИНА
	//|			КОНЕЦ)
	//|			И (вогОтветственныеЛицаОрганизаций.ДатаОкончания = &ДатаПоУмолчанию
	//|				ИЛИ вогОтветственныеЛицаОрганизаций.ДатаОкончания > &ТекущаяДата)
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	//|	ПРЕДСТАВЛЕНИЕССЫЛКИ(вогКомандировкаРасходыПроезд.ГородПрибытия) КАК Город
	//|ИЗ
	//|	Документ.вогКомандировка.РасходыПроезд КАК вогКомандировкаРасходыПроезд
	//|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	//|		ПО вогКомандировкаРасходыПроезд.Ссылка = ВТ_Сотрудники.Командировка
	//|			И вогКомандировкаРасходыПроезд.Сотрудник = ВТ_Сотрудники.Сотрудник
	//|ГДЕ
	//|	вогКомандировкаРасходыПроезд.ВыдатьПодотчет
	//|;
	//|
	//|////////////////////////////////////////////////////////////////////////////////
	//|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	//|	ПРЕДСТАВЛЕНИЕССЫЛКИ(вогКомандировкаРасходыПроезд.ВидТранспорта) КАК ВидТранспорта
	//|ИЗ
	//|	Документ.вогКомандировка.РасходыПроезд КАК вогКомандировкаРасходыПроезд
	//|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	//|		ПО вогКомандировкаРасходыПроезд.Ссылка = ВТ_Сотрудники.Командировка
	//|			И вогКомандировкаРасходыПроезд.Сотрудник = ВТ_Сотрудники.Сотрудник
	//|ГДЕ
	//|	вогКомандировкаРасходыПроезд.ВыдатьПодотчет";
	// +
	Запрос.Текст 									= 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	вогКомандировкаКомандированныеСотрудники.Сотрудник.Подразделение.Организация КАК Организация
	|ПОМЕСТИТЬ ВТ_СотрудникиВодитель
	|ИЗ
	|	Документ.вогКомандировка.КомандированныеСотрудники КАК вогКомандировкаКомандированныеСотрудники
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.вогЭтапыСогласованияКомандировок КАК вогЭтапыСогласованияКомандировок
	|		ПО вогКомандировкаКомандированныеСотрудники.Ссылка = вогЭтапыСогласованияКомандировок.Командировка
	|			И (&ЭтоВодитель)
	|			И (НЕ вогКомандировкаКомандированныеСотрудники.Сотрудник = &Водитель)
	|ГДЕ
	|	НЕ вогЭтапыСогласованияКомандировок.Этап В (&ЭтапыНЕВыводить)
	|	И вогКомандировкаКомандированныеСотрудники.Ссылка = &ТекущийДокумент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	вогКомандировкаКомандированныеСотрудники.Ссылка КАК Командировка,
	|	МИНИМУМ(вогКомандировкаКомандированныеСотрудники.НомерСтроки) КАК НомерСтроки,
	|	вогКомандировкаКомандированныеСотрудники.Сотрудник КАК Сотрудник,
	|	вогКомандировкаКомандированныеСотрудники.Сотрудник.Наименование КАК СотрудникФИОПолностьюИП,
	//--> VOG Турский Сергей 06.04.2021 15:24:28 ID заявки: DEV-215.
	// -
	// |	вогКомандировкаКомандированныеСотрудники.Сотрудник.CRM_ДолжностнаяПозиция КАК СотрудникДолжностьИП,
	// +
	|	вогКомандировкаКомандированныеСотрудники.Сотрудник.CRM_ДолжностнаяПозиция.Наименование КАК СотрудникДолжностьНаименованиеИП,
	|	вогКомандировкаКомандированныеСотрудники.Сотрудник.CRM_ДолжностнаяПозиция.НаименованиеДляПечати КАК СотрудникДолжностьНаименованиеДляПечатиИП,
	//<-- VOG Турский Сергей 06.04.2021 15:24:41 ID заявки: DEV-215.
	|	вогКомандировкаКомандированныеСотрудники.Сотрудник.ФизическоеЛицо.Пол КАК СотрудникПол,
	|	ВЫБОР
	|		КОГДА вогКомандировкаКомандированныеСотрудники.Сотрудник = &Водитель
	|			ТОГДА ВТ_СотрудникиВодитель.Организация
	|		ИНАЧЕ вогКомандировкаКомандированныеСотрудники.Сотрудник.Подразделение.Организация
	|	КОНЕЦ КАК Организация
	|ПОМЕСТИТЬ ВТ_Сотрудники
	|ИЗ
	|	Документ.вогКомандировка.КомандированныеСотрудники КАК вогКомандировкаКомандированныеСотрудники
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.вогЭтапыСогласованияКомандировок КАК вогЭтапыСогласованияКомандировок
	|		ПО вогКомандировкаКомандированныеСотрудники.Ссылка = вогЭтапыСогласованияКомандировок.Командировка
	|		ПОЛНОЕ СОЕДИНЕНИЕ ВТ_СотрудникиВодитель КАК ВТ_СотрудникиВодитель
	|		ПО (ИСТИНА)
	|ГДЕ
	|	НЕ вогЭтапыСогласованияКомандировок.Этап В (&ЭтапыНЕВыводить)
	|	И вогКомандировкаКомандированныеСотрудники.Ссылка = &ТекущийДокумент
	|	И вогКомандировкаКомандированныеСотрудники.Сотрудник = &СотрудникОтбор
	|
	|СГРУППИРОВАТЬ ПО
	|	вогКомандировкаКомандированныеСотрудники.Сотрудник,
	|	вогКомандировкаКомандированныеСотрудники.Сотрудник.Наименование,
	//--> VOG Турский Сергей 06.04.2021 15:26:37 ID заявки: DEV-215.
	// -
	// |	вогКомандировкаКомандированныеСотрудники.Сотрудник.CRM_ДолжностнаяПозиция,
	// +
	|	вогКомандировкаКомандированныеСотрудники.Сотрудник.CRM_ДолжностнаяПозиция.Наименование,
	|	вогКомандировкаКомандированныеСотрудники.Сотрудник.CRM_ДолжностнаяПозиция.НаименованиеДляПечати,
	//<-- VOG Турский Сергей 06.04.2021 15:26:38 ID заявки: DEV-215.
	|	вогКомандировкаКомандированныеСотрудники.Сотрудник.ФизическоеЛицо.Пол,
	|	вогКомандировкаКомандированныеСотрудники.Ссылка,
	|	ВЫБОР
	|		КОГДА вогКомандировкаКомандированныеСотрудники.Сотрудник = &Водитель
	|			ТОГДА ВТ_СотрудникиВодитель.Организация
	|		ИНАЧЕ вогКомандировкаКомандированныеСотрудники.Сотрудник.Подразделение.Организация
	|	КОНЕЦ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	""Проживание"" КАК СтатьяРасхода,
	|	вогКомандировкаРасходыПроживание.Стоимость КАК Сумма
	|ПОМЕСТИТЬ ВТ_ДляТаблицы2
	|ИЗ
	|	Документ.вогКомандировка.РасходыПроживание КАК вогКомандировкаРасходыПроживание
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	|		ПО вогКомандировкаРасходыПроживание.Ссылка = ВТ_Сотрудники.Командировка
	|			И (вогКомандировкаРасходыПроживание.Сотрудник = ВТ_Сотрудники.Сотрудник
	|				ИЛИ вогКомандировкаРасходыПроживание.Сотрудник = &ПустойСотрудник
	|					И &НомерСтроки = 1)
	|ГДЕ
	|	вогКомандировкаРасходыПроживание.ВыдатьПодотчет
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	""Суточные"",
	|	вогКомандировкаКомандированныеСотрудники.Сумма
	|ИЗ
	|	Документ.вогКомандировка.КомандированныеСотрудники КАК вогКомандировкаКомандированныеСотрудники
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	|		ПО вогКомандировкаКомандированныеСотрудники.Ссылка = ВТ_Сотрудники.Командировка
	|			И (вогКомандировкаКомандированныеСотрудники.Сотрудник = ВТ_Сотрудники.Сотрудник
	|				ИЛИ вогКомандировкаКомандированныеСотрудники.Сотрудник = &ПустойСотрудник
	|					И &НомерСтроки = 1)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	""Проезд"",
	|	вогКомандировкаРасходыПроезд.Стоимость
	|ИЗ
	|	Документ.вогКомандировка.РасходыПроезд КАК вогКомандировкаРасходыПроезд
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	|		ПО вогКомандировкаРасходыПроезд.Ссылка = ВТ_Сотрудники.Командировка
	|			И (вогКомандировкаРасходыПроезд.Сотрудник = ВТ_Сотрудники.Сотрудник
	|				ИЛИ вогКомандировкаРасходыПроезд.Сотрудник = &ПустойСотрудник
	|					И &НомерСтроки = 1)
	|ГДЕ
	|	вогКомандировкаРасходыПроезд.ВыдатьПодотчет
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_ДляТаблицы2.СтатьяРасхода КАК СтатьяРасхода,
	|	СУММА(ВТ_ДляТаблицы2.Сумма) КАК Сумма
	|ИЗ
	|	ВТ_ДляТаблицы2 КАК ВТ_ДляТаблицы2
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_ДляТаблицы2.СтатьяРасхода
	|ИТОГИ
	|	СУММА(Сумма)
	|ПО
	|	ОБЩИЕ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	вогКомандировкаДополнительныеРасходы.ВидРасхода КАК ВидРасходаСсылка,
	|	ПРЕДСТАВЛЕНИЕССЫЛКИ(вогКомандировкаДополнительныеРасходы.ВидРасхода) КАК ВидРасхода,
	|	СУММА(вогКомандировкаДополнительныеРасходы.Сумма) КАК ДополнительныеРасходы
	|ИЗ
	|	Документ.вогКомандировка.ДополнительныеРасходы КАК вогКомандировкаДополнительныеРасходы
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	|		ПО вогКомандировкаДополнительныеРасходы.Ссылка = ВТ_Сотрудники.Командировка
	|			И (вогКомандировкаДополнительныеРасходы.Сотрудник = ВТ_Сотрудники.Сотрудник
	|				ИЛИ вогКомандировкаДополнительныеРасходы.Сотрудник = &ПустойСотрудник
	|					И &НомерСтроки = 1)
	|ГДЕ
	|	вогКомандировкаДополнительныеРасходы.ВыдатьПодотчет
	|
	|СГРУППИРОВАТЬ ПО
	|	вогКомандировкаДополнительныеРасходы.ВидРасхода
	|
	|УПОРЯДОЧИТЬ ПО
	|	ВидРасходаСсылка
	|ИТОГИ
	|	СУММА(ДополнительныеРасходы)
	|ПО
	|	ОБЩИЕ
	|АВТОУПОРЯДОЧИВАНИЕ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 1
	|	ЕСТЬNULL(вогОтветственныеЛицаОрганизаций.Владелец.НаименованиеСокращенное, """") КАК ОрганизацияНаименование,
	|	ЕСТЬNULL(вогОтветственныеЛицаОрганизаций.Должность, """") КАК РуководительДолжностьИП,
	|	ПРЕДСТАВЛЕНИЕССЫЛКИ(ЕСТЬNULL(вогОтветственныеЛицаОрганизаций.ФизическоеЛицо, &ПустоеФЛ)) КАК РуководительФИОПолностьюИП,
	|	ЕСТЬNULL(вогОтветственныеЛицаОрганизаций.ФизическоеЛицо.Пол, &ПустойПолФЛ) КАК РуководительПол,
	|	ВТ_Сотрудники.НомерСтроки КАК НомерСтроки,
	|	ВТ_Сотрудники.СотрудникФИОПолностьюИП КАК СотрудникФИОПолностьюИП,
	//--> VOG Турский Сергей 06.04.2021 15:27:30 ID заявки: DEV-215.
	// -
	// |	ВТ_Сотрудники.СотрудникДолжностьИП КАК СотрудникДолжностьИП,
	// +
	|	ВТ_Сотрудники.СотрудникДолжностьНаименованиеИП КАК СотрудникДолжностьНаименованиеИП,
	|	ВТ_Сотрудники.СотрудникДолжностьНаименованиеДляПечатиИП КАК СотрудникДолжностьНаименованиеДляПечатиИП,
	//<-- VOG Турский Сергей 06.04.2021 15:27:31 ID заявки: DEV-215.
	|	ВТ_Сотрудники.СотрудникПол КАК СотрудникПол,
	|	ВТ_Сотрудники.Командировка.ВремяНачала КАК ВремяНачала,
	|	ВТ_Сотрудники.Командировка.ВремяОкончания КАК ВремяОкончания
	|ИЗ
	|	ВТ_Сотрудники КАК ВТ_Сотрудники
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.вогОтветственныеЛицаОрганизаций КАК вогОтветственныеЛицаОрганизаций
	|		ПО (вогОтветственныеЛицаОрганизаций.Владелец = ВТ_Сотрудники.Организация)
	|			И (ВЫБОР
	|				КОГДА ВТ_Сотрудники.Организация.ИНН = &ИННВОГЮг
	|					ТОГДА вогОтветственныеЛицаОрганизаций.Должность = &ДолжностьЗамГенеральногоДиректораПоРазвитию
	|				ИНАЧЕ ИСТИНА
	|			КОНЕЦ)
	|			И (вогОтветственныеЛицаОрганизаций.ДатаОкончания = &ДатаПоУмолчанию
	|				ИЛИ вогОтветственныеЛицаОрганизаций.ДатаОкончания > &ТекущаяДата)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	//--> VOG Турский Сергей 14.04.2021 18:47:25 ID заявки: DEV-215.
	|	вогКомандировкаРасходыПроезд.НомерСтроки КАК НомерСтроки,
	//<-- VOG Турский Сергей 14.04.2021 18:47:26 ID заявки: DEV-215.
	|	ПРЕДСТАВЛЕНИЕССЫЛКИ(вогКомандировкаРасходыПроезд.ГородПрибытия) КАК Город
	|ИЗ
	|	Документ.вогКомандировка.РасходыПроезд КАК вогКомандировкаРасходыПроезд
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	|		ПО вогКомандировкаРасходыПроезд.Ссылка = ВТ_Сотрудники.Командировка
	|			И вогКомандировкаРасходыПроезд.Сотрудник = ВТ_Сотрудники.Сотрудник
	|ГДЕ
	|	вогКомандировкаРасходыПроезд.ВыдатьПодотчет
	//--> VOG Турский Сергей 06.04.2021 15:53:17 ID заявки: DEV-215.
	|	И НЕ вогКомандировкаРасходыПроезд.ВидТранспорта = &ВидТранспортаТакси
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки
	//<-- VOG Турский Сергей 06.04.2021 15:53:23 ID заявки: DEV-215.
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	//--> VOG Турский Сергей 06.04.2021 16:21:36 ID заявки: DEV-215.
	// -
	// |	ПРЕДСТАВЛЕНИЕССЫЛКИ(вогКомандировкаРасходыПроезд.ВидТранспорта) КАК ВидТранспорта
	// +
	|	ВЫБОР
	|		КОГДА вогКомандировкаРасходыПроезд.ВидТранспорта = &ВидТранспортаСлужебныйТранспорт
	|			ТОГДА ""авто""
	|		КОГДА вогКомандировкаРасходыПроезд.ВидТранспорта = &ВидТранспортаЖД
	|			ТОГДА ""ж/д""
	|		КОГДА вогКомандировкаРасходыПроезд.ВидТранспорта = &ВидТранспортаСамолет
	|			ТОГДА ""авиа""
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК ВидТранспорта
	//<-- VOG Турский Сергей 06.04.2021 16:21:36 ID заявки: DEV-215.
	|ИЗ
	|	Документ.вогКомандировка.РасходыПроезд КАК вогКомандировкаРасходыПроезд
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Сотрудники КАК ВТ_Сотрудники
	|		ПО вогКомандировкаРасходыПроезд.Ссылка = ВТ_Сотрудники.Командировка
	|			И вогКомандировкаРасходыПроезд.Сотрудник = ВТ_Сотрудники.Сотрудник
	|ГДЕ
	//--> VOG Турский Сергей 06.04.2021 16:10:51 ID заявки: DEV-215.
	// -
	// |	вогКомандировкаРасходыПроезд.ВыдатьПодотчет";
	// +
	|	вогКомандировкаРасходыПроезд.ВыдатьПодотчет
	|	И вогКомандировкаРасходыПроезд.ВидТранспорта В(&ВидыТранспорта)";
	//<-- VOG Турский Сергей 06.04.2021 16:11:00 ID заявки: DEV-215.
	//<-- VOG Турский Сергей 25.12.2020 16:39:28 ID заявки: DEV-21.
	
	СпрПользователи 								= Справочники.Пользователи;
	Водитель 										= СпрПользователи.Водитель;
	ЭтоВодитель 									= СотрудникОтбор = Водитель;
	
	ЭтапыСогласованияКомандировок 					= Перечисления.вогЭтапыСогласованияКомандировок;
	ЭтапыНЕВыводить 								= Новый Массив;
	ЭтапыНЕВыводить.Добавить(ЭтапыСогласованияКомандировок.НеСогласовано);
	ЭтапыНЕВыводить.Добавить(ЭтапыСогласованияКомандировок.УчастиеОтклонено);
	
	//--> VOG Турский Сергей 25.12.2020 17:30:33 ID заявки: DEV-21.
	// -
	//ВидыТранспорта 									= Справочники.вогВидыТранспорта;
	//ВидТранспортаАрендаТакси 						= Новый Массив;
	//ВидТранспортаАрендаТакси.Добавить(ВидыТранспорта.Аренда);
	//ВидТранспортаАрендаТакси.Добавить(ВидыТранспорта.Такси);
	
	//ВидТранспортаПроездСтоянка 						= Новый Массив;
	//ВидТранспортаПроездСтоянка.Добавить(ВидыТранспорта.МеждугороднийАвтобус);
	//ВидТранспортаПроездСтоянка.Добавить(ВидыТранспорта.ЖД);
	//ВидТранспортаПроездСтоянка.Добавить(ВидыТранспорта.Самолет);
	
	//ВидТранспортаОтбор 								= Новый Массив;
	//ОбщегоНазначенияКлиентСервер.ДополнитьМассив(ВидТранспортаОтбор, ВидТранспортаАрендаТакси, Истина);
	//ОбщегоНазначенияКлиентСервер.ДополнитьМассив(ВидТранспортаОтбор, ВидТранспортаПроездСтоянка, Истина);
	
	//ВидыРасходов 									= Справочники.вогВидыРасходов;
	//ВидРасходаМобильнаяСвязь 						= ВидыРасходов.МобильнаяСвязь;
	//ВидРасходаПлатнаяДорогаСтоянка 					= ВидыРасходов.ПлатнаяДорогаСтоянка;
	//ВидРасходаПрочее 								= ВидыРасходов.Прочее;
	
	//ВидыРасходовОтбор 								= Новый Массив;
	//ВидыРасходовОтбор.Добавить(ВидРасходаМобильнаяСвязь);
	//ВидыРасходовОтбор.Добавить(ВидРасходаПлатнаяДорогаСтоянка);
	//ВидыРасходовОтбор.Добавить(ВидРасходаПрочее);
	//<-- VOG Турский Сергей 25.12.2020 17:30:33 ID заявки: DEV-21.
	
	//--> VOG Турский Сергей 06.04.2021 16:12:58 ID заявки: DEV-215.
	СправочникВидыТранспорта 						= Справочники.вогВидыТранспорта;
	
	ВидТранспортаТакси 								= СправочникВидыТранспорта.Такси;
	ВидТранспортаСлужебныйТранспорт 				= СправочникВидыТранспорта.СлужебныйТранспорт;
	ВидТранспортаЖД 								= СправочникВидыТранспорта.ЖД;
	ВидТранспортаСамолет 							= СправочникВидыТранспорта.Самолет;
	
	ВидыТранспорта 									= Новый Массив;
	ВидыТранспорта.Добавить(ВидТранспортаСлужебныйТранспорт);
	ВидыТранспорта.Добавить(ВидТранспортаЖД);
	ВидыТранспорта.Добавить(ВидТранспортаСамолет);
	//<-- VOG Турский Сергей 06.04.2021 16:12:59 ID заявки: DEV-215.
	
	Запрос.УстановитьПараметр("ТекущийДокумент", 										ТекущийДокумент);
	Запрос.УстановитьПараметр("ЭтапыНЕВыводить", 										ЭтапыНЕВыводить);
	Запрос.УстановитьПараметр("СотрудникОтбор", 										СотрудникОтбор);
	Запрос.УстановитьПараметр("ИННВОГЮг", 												"6164223455");
	Запрос.УстановитьПараметр("ДолжностьЗамГенеральногоДиректораПоРазвитию", 			"Заместитель генерального директора по развитию");
	Запрос.УстановитьПараметр("ДатаПоУмолчанию", 										Дата(1, 1, 1));
	Запрос.УстановитьПараметр("ТекущаяДата", 											ТекущаяДата());
	Запрос.УстановитьПараметр("ПустоеФЛ", 												Справочники.ФизическиеЛица.ПустаяСсылка());
	Запрос.УстановитьПараметр("ПустойПолФЛ", 											Перечисления.ПолФизическогоЛица.ПустаяСсылка());
	//--> VOG Турский Сергей 25.12.2020 17:31:06 ID заявки: DEV-21.
	// -
	//Запрос.УстановитьПараметр("ВидТранспортаАрендаТакси", 								ВидТранспортаАрендаТакси);
	//Запрос.УстановитьПараметр("ВидТранспортаПроездСтоянка", 							ВидТранспортаПроездСтоянка);
	//Запрос.УстановитьПараметр("ВидТранспортаОтбор", 									ВидТранспортаОтбор);
	//Запрос.УстановитьПараметр("ВидРасходаМобильнаяСвязь", 								ВидРасходаМобильнаяСвязь);
	//Запрос.УстановитьПараметр("ВидРасходаПлатнаяДорогаСтоянка", 						ВидРасходаПлатнаяДорогаСтоянка);
	//Запрос.УстановитьПараметр("ВидРасходаПрочее", 										ВидРасходаПрочее);
	//Запрос.УстановитьПараметр("ВидыРасходовОтбор", 										ВидыРасходовОтбор);
	//<-- VOG Турский Сергей 25.12.2020 17:31:07 ID заявки: DEV-21.
	Запрос.УстановитьПараметр("НомерСтроки", 											НомерСтроки);
	Запрос.УстановитьПараметр("ПустойСотрудник", 										СпрПользователи.ПустаяСсылка());
	Запрос.УстановитьПараметр("ЭтоВодитель", 											ЭтоВодитель);
	Запрос.УстановитьПараметр("Водитель", 												Водитель);
	//--> VOG Турский Сергей 06.04.2021 15:53:49 ID заявки: DEV-215.
	Запрос.УстановитьПараметр("ВидТранспортаТакси", 									ВидТранспортаТакси);
	Запрос.УстановитьПараметр("ВидТранспортаСлужебныйТранспорт", 						ВидТранспортаСлужебныйТранспорт);
	Запрос.УстановитьПараметр("ВидТранспортаЖД", 										ВидТранспортаЖД);
	Запрос.УстановитьПараметр("ВидТранспортаСамолет", 									ВидТранспортаСамолет);
	Запрос.УстановитьПараметр("ВидыТранспорта", 										ВидыТранспорта);
	//<-- VOG Турский Сергей 06.04.2021 15:53:49 ID заявки: DEV-215.
	
	РезультатПакет 									= Запрос.ВыполнитьПакет();
	РезультатТаблица2 								= РезультатПакет[3];
	//--> VOG Турский Сергей 25.12.2020 16:25:00 ID заявки: DEV-21.
	// -
	//РезультатОбщиеДанные 							= РезультатПакет[4];
	//РезультатГород		 							= РезультатПакет[5];
	//РезультатВидТранспорта 							= РезультатПакет[6];
	// +
	РезультатТаблица2ДополнительныеРасходы 			= РезультатПакет[4];
	РезультатОбщиеДанные 							= РезультатПакет[5];
	РезультатГород		 							= РезультатПакет[6];
	РезультатВидТранспорта 							= РезультатПакет[7];
	//<-- VOG Турский Сергей 25.12.2020 16:25:01 ID заявки: DEV-21.
	
	Город 											= "";	
	Период 											= "";	
	ВидТранспорта 									= "";
	
	ИтогоКВыдаче 									= 0;
	Если НЕ РезультатТаблица2.Пустой() Тогда
		
		ВыборкаТаблица2Итоги 				= РезультатТаблица2.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		ВыборкаТаблица2Итоги.Следующий();
		
		ИтогоКВыдаче 						= ВыборкаТаблица2Итоги.Сумма;
		
		ВыборкаТаблица2 					= ВыборкаТаблица2Итоги.Выбрать();
		
		Пока ВыборкаТаблица2.Следующий() Цикл
			ОбластьТаблица2.Параметры[ВыборкаТаблица2.СтатьяРасхода] = ВыборкаТаблица2.Сумма;	
		КонецЦикла;
		
	КонецЕсли;
	
	//--> VOG Турский Сергей 25.12.2020 16:58:58 ID заявки: DEV-21.
	Если НЕ РезультатТаблица2ДополнительныеРасходы.Пустой() Тогда
		
		ВыборкаТаблица2ДополнительныеРасходыИтоги 	= РезультатТаблица2ДополнительныеРасходы.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		ВыборкаТаблица2ДополнительныеРасходыИтоги.Следующий();
		
		ИтогоКВыдаче 								= ИтогоКВыдаче + ВыборкаТаблица2ДополнительныеРасходыИтоги.ДополнительныеРасходы;
		
		ВыборкаТаблица2ДополнительныеРасходы 		= ВыборкаТаблица2ДополнительныеРасходыИтоги.Выбрать();
		
		Пока ВыборкаТаблица2ДополнительныеРасходы.Следующий() Цикл
			ОбластьТаблица2ДополнительныеРасходы.Параметры.Заполнить(ВыборкаТаблица2ДополнительныеРасходы);	
		КонецЦикла;
		
	КонецЕсли;
	//<-- VOG Турский Сергей 25.12.2020 16:58:59 ID заявки: DEV-21.
	
	ОбластьЗаголовок.Параметры.ИтогоКВыдаче 		= ИтогоКВыдаче;
	//--> VOG Турский Сергей 25.12.2020 17:08:06 ID заявки: DEV-21.
	// -
	// ОбластьТаблица2.Параметры.ИтогоКВыдаче 			= ИтогоКВыдаче;
	// +
	ОбластьИтогоКВыдаче.Параметры.ИтогоКВыдаче 			= ИтогоКВыдаче;
	//<-- VOG Турский Сергей 25.12.2020 17:08:07 ID заявки: DEV-21.
	//--> VOG Турский Сергей 06.04.2021 16:40:15 ID заявки: DEV-215.
	// -
	// ОбластьЗаголовок.Параметры.ИтогоКВыдачеПрописью = РаботаСКурсамиВалют.СформироватьСуммуПрописью(ИтогоКВыдаче, ВалютаРегламентированногоУчета);
	// +
	ИтогоКВыдачеПрописью 								= РаботаСКурсамиВалют.СформироватьСуммуПрописью(ИтогоКВыдаче, ВалютаРегламентированногоУчета);
	ОбластьЗаголовок.Параметры.ИтогоКВыдачеПрописью 	= ИтогоКВыдачеПрописью;
	//<-- VOG Турский Сергей 06.04.2021 16:40:16 ID заявки: DEV-215.
	
	Если НЕ РезультатОбщиеДанные.Пустой() Тогда
		
		ФорматДаты 													= "ДЛФ=D";
		ВыборкаОбщиеДанные 											= РезультатОбщиеДанные.Выбрать();
		ВыборкаОбщиеДанные.Следующий();
		
		РуководительДолжностьСклонения 								= Справочники.CRM_Должности.ПолучитьСтруктуруСклонения(ВыборкаОбщиеДанные.РуководительДолжностьИП);	
		ОбластьШапка.Параметры.РуководительДолжностьИОрганизацияДП 	= РуководительДолжностьСклонения.Дательный + " " + ВыборкаОбщиеДанные.ОрганизацияНаименование;
		
		РуководительФИОПолностьюДП 									= "";
		Если ФизическиеЛица.Просклонять(ВыборкаОбщиеДанные.РуководительФИОПолностьюИП, 3, РуководительФИОПолностьюДП, ВыборкаОбщиеДанные.РуководительПол) Тогда 
			РуководительФИОДП = CRM_ФизическиеЛицаКлиентСервер.ФамилияИнициалыФизЛица(РуководительФИОПолностьюДП);
		Иначе  	
			РуководительФИОДП = CRM_ФизическиеЛицаКлиентСервер.ФамилияИнициалыФизЛица(ВыборкаОбщиеДанные.РуководительФИОПолностьюИП);
		КонецЕсли;
		
		ОбластьШапка.Параметры.РуководительФИОДП 					= РуководительФИОДП;
		
		Если ЭтоВодитель Тогда
			СотрудникДолжностьИП = "";
		Иначе
			//--> VOG Турский Сергей 06.04.2021 15:29:21 ID заявки: DEV-215.
			// -
			// СотрудникДолжностьИП = ВыборкаОбщиеДанные.СотрудникДолжностьИП;
			// +
			Если ПустаяСтрока(ВыборкаОбщиеДанные.СотрудникДолжностьНаименованиеДляПечатиИП) Тогда
				СотрудникДолжностьИП = ВыборкаОбщиеДанные.СотрудникДолжностьНаименованиеИП;
			Иначе
				СотрудникДолжностьИП = ВыборкаОбщиеДанные.СотрудникДолжностьНаименованиеДляПечатиИП;
			КонецЕсли;
			//<-- VOG Турский Сергей 06.04.2021 15:29:22 ID заявки: DEV-215.
		КонецЕсли;
		
		СотрудникДолжностьСклонения 								= Справочники.CRM_Должности.ПолучитьСтруктуруСклонения(СотрудникДолжностьИП);	
		
		ОбластьШапка.Параметры.СотрудникДолжностьРП 				= СотрудникДолжностьСклонения.Родительный;
		
		СотрудникФИОПолностьюРП 									= "";
		СотрудникФИОРП												= "";
		
		Если НЕ ЭтоВодитель Тогда
			Если ФизическиеЛица.Просклонять(ВыборкаОбщиеДанные.СотрудникФИОПолностьюИП, 2, СотрудникФИОПолностьюРП, ВыборкаОбщиеДанные.СотрудникПол) Тогда 
				СотрудникФИОРП = CRM_ФизическиеЛицаКлиентСервер.ФамилияИнициалыФизЛица(СотрудникФИОПолностьюРП);
			Иначе  	
				СотрудникФИОРП = CRM_ФизическиеЛицаКлиентСервер.ФамилияИнициалыФизЛица(ВыборкаОбщиеДанные.СотрудникФИОПолностьюИП);
			КонецЕсли;
		КонецЕсли;
		
		ОбластьШапка.Параметры.СотрудникФИОРП 						= СотрудникФИОРП;
		
		Период 														= Формат(ВыборкаОбщиеДанные.ВремяНачала, ФорматДаты) + " - " + Формат(ВыборкаОбщиеДанные.ВремяОкончания, ФорматДаты);
		
		Если ЭтоВодитель Тогда
			СотрудникФИОИП = "________________________";
		Иначе
			СотрудникФИОИП = CRM_ФизическиеЛицаКлиентСервер.ФамилияИнициалыФизЛица(ВыборкаОбщиеДанные.СотрудникФИОПолностьюИП);
		КонецЕсли;
		
		ОбластьПодвал.Параметры.СотрудникФИОИП 						= СотрудникФИОИП;
		ОбластьПодвал.Параметры.РуководительФИОИП 					= CRM_ФизическиеЛицаКлиентСервер.ФамилияИнициалыФизЛица(ВыборкаОбщиеДанные.РуководительФИОПолностьюИП);
		
	КонецЕсли;
	
	Если НЕ РезультатГород.Пустой() Тогда
		
		ВыборкаГород 			= РезультатГород.Выбрать();
		//--> VOG Турский Сергей 06.04.2021 15:56:37 ID заявки: DEV-215.
		КоличествоГород 		= ВыборкаГород.Количество();
		СчГород         		= 1;
		//<-- VOG Турский Сергей 06.04.2021 15:56:37 ID заявки: DEV-215.
		Пока ВыборкаГород.Следующий() Цикл
			//--> VOG Турский Сергей 06.04.2021 15:58:28 ID заявки: DEV-215.
			
			Если СчГород = КоличествоГород Тогда
				Прервать;
			КонецЕсли;
			
			//<-- VOG Турский Сергей 06.04.2021 15:58:29 ID заявки: DEV-215.
			Город 	= ?(ПустаяСтрока(Город), "", Город + ", ") + СокрЛП(ВыборкаГород.Город);
			//--> VOG Турский Сергей 06.04.2021 15:59:13 ID заявки: DEV-215.
			
			СчГород = СчГород + 1;
			
			//<-- VOG Турский Сергей 06.04.2021 15:59:13 ID заявки: DEV-215.
			
		КонецЦикла;
		
		//--> VOG Турский Сергей 06.04.2021 16:06:38 ID заявки: DEV-215.
		// -
		// Город 					= ?(ПустаяСтрока(Город), "", Город) + ".";
		// +
		Город 					= ?(ПустаяСтрока(Город), "", Город + ".");
		//<-- VOG Турский Сергей 06.04.2021 16:06:46 ID заявки: DEV-215.
		
	КонецЕсли;
	
	Если НЕ РезультатВидТранспорта.Пустой() Тогда
		
		//--> VOG Турский Сергей 06.04.2021 16:32:46 ID заявки: DEV-215.
		ЭтоПервыйВидТранспорта = Истина;
		//<-- VOG Турский Сергей 06.04.2021 16:32:47 ID заявки: DEV-215.
		
		ВыборкаВидТранспорта 	= РезультатВидТранспорта.Выбрать();
		Пока ВыборкаВидТранспорта.Следующий() Цикл
			//--> VOG Турский Сергей 06.04.2021 16:33:40 ID заявки: DEV-215.
			// -
			// ВидТранспорта 	= ?(ПустаяСтрока(ВидТранспорта), "", ВидТранспорта + ", ") + СокрЛП(ВыборкаВидТранспорта.ВидТранспорта);
			// +
			ВидТранспортаВыборка 	= СокрЛП(ВыборкаВидТранспорта.ВидТранспорта);
			ВидТранспортаВыборка 	= ?(ЭтоПервыйВидТранспорта, ТРег(ВидТранспортаВыборка), ВидТранспортаВыборка);
			ВидТранспорта 			= ?(ПустаяСтрока(ВидТранспорта), "", ВидТранспорта + ", ") + ВидТранспортаВыборка;
			ЭтоПервыйВидТранспорта 	= Ложь;
			//<-- VOG Турский Сергей 06.04.2021 16:33:41 ID заявки: DEV-215.
		КонецЦикла;
		
		//--> VOG Турский Сергей 06.04.2021 16:07:08 ID заявки: DEV-215.
		// -
		// ВидТранспорта 			= ?(ПустаяСтрока(ВидТранспорта), "", ВидТранспорта) + ".";
		// +
		ВидТранспорта 			= ?(ПустаяСтрока(ВидТранспорта), "", ВидТранспорта + ".");
		//<-- VOG Турский Сергей 06.04.2021 16:07:08 ID заявки: DEV-215.
		
	КонецЕсли;
	
	ОбластьТаблица1.Параметры.Город 			= Город;
	ОбластьТаблица1.Параметры.Период 			= Период;
	ОбластьТаблица1.Параметры.ВидТранспорта		= ВидТранспорта;
	
	ДатаПодписи 								= СтрЗаменить(Формат(ТекущаяДата(), "ДФ=dd.MMMM.yyyy"), ".", " ");
	ОбластьПодвал.Параметры.ДатаПодписи 		= """" + Лев(ДатаПодписи, 2) + """" + Прав(ДатаПодписи, СтрДлина(ДатаПодписи) - 2);
	
	ТабДокумент.Вывести(ОбластьШапка);
	ТабДокумент.Вывести(ОбластьЗаголовок);
	ТабДокумент.Вывести(ОбластьТаблица1);
	ТабДокумент.Вывести(ОбластьТаблица2);
	
	//--> VOG Турский Сергей 25.12.2020 17:02:42 ID заявки: DEV-21.
	Если НЕ РезультатТаблица2ДополнительныеРасходы.Пустой() Тогда
		
		ВыборкаТаблица2ДополнительныеРасходы 		= ВыборкаТаблица2ДополнительныеРасходыИтоги.Выбрать();
		
		Пока ВыборкаТаблица2ДополнительныеРасходы.Следующий() Цикл
			ОбластьТаблица2ДополнительныеРасходы.Параметры.Заполнить(ВыборкаТаблица2ДополнительныеРасходы);	
			ТабДокумент.Вывести(ОбластьТаблица2ДополнительныеРасходы);
		КонецЦикла;
		
	КонецЕсли;
	
	ТабДокумент.Вывести(ОбластьИтогоКВыдаче);
	//<-- VOG Турский Сергей 25.12.2020 17:02:43 ID заявки: DEV-21.
	
	//--> VOG Турский Сергей 06.04.2021 16:42:30 ID заявки: DEV-215.
	ОбластьПодвал.Параметры.ИтогоКВыдаче 			= ИтогоКВыдаче;
	ОбластьПодвал.Параметры.ИтогоКВыдачеПрописью	= ИтогоКВыдачеПрописью;
	//<-- VOG Турский Сергей 06.04.2021 16:42:31 ID заявки: DEV-215.
	
	ТабДокумент.Вывести(ОбластьПодвал);
	
	УправлениеПечатью.ЗадатьОбластьПечатиДокумента(ТабДокумент, НомерСтрокиНачало, ОбъектыПечати, ТекущийДокумент);
	
	Возврат ТабДокумент;
	
КонецФункции // ПечатьЗаявлениеНаВыдачуДенежныхСредств()	




Процедура ОбновитьДанныеКомандировки(Объект) Экспорт //Павелко, Таск 000000936, 28.11.2019
	
	мКомандированныеСотрудники = Объект.КомандированныеСотрудники.НайтиСтроки(Новый Структура("ДобавленАвтоматически",Ложь)); //Павелко, Задача CRM-284, 11.02.2020
	
	//Павелко, Задача CRM-284, 11.02.2020 - убрал отказавшихся от мероприятия
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	CRM_МероприятиеСвоиЛица.Лицо КАК Сотрудник,
		|	ИСТИНА КАК ДобавленАвтоматически,
		// +++ VOG Кулаков П.Л. 24.03.2020 CRM-463
		|	0 КАК КоличествоДней,
		|	0 КАК Сумма,
		// ++ VOG Солодов В.В. 24.12.2020 CRM-1098
		|	ЛОЖЬ КАК Соисполнитель
		// -- VOG Солодов В.В. 24.12.2020 CRM-1098
        // --- VOG Кулаков П.Л.
		|ИЗ
		|	Документ.CRM_Мероприятие.СвоиЛица КАК CRM_МероприятиеСвоиЛица
		|ГДЕ
		|	CRM_МероприятиеСвоиЛица.Ссылка В(&Задачи)
		|	И НЕ CRM_МероприятиеСвоиЛица.ПосетитМероприятие = 0
		|	И CRM_МероприятиеСвоиЛица.Роль <> &РольНаблюдатель
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	CRM_Мероприятие.Ответственный,
		|	ИСТИНА,
		// +++ VOG Кулаков П.Л. 24.03.2020 CRM-463
		|	0,
		|	0,
		// ++ VOG Солодов В.В. 24.12.2020 CRM-1098
		|	ЛОЖЬ
		// -- VOG Солодов В.В. 24.12.2020 CRM-1098
        // --- VOG Кулаков П.Л.
		|ИЗ
		|	Документ.CRM_Мероприятие КАК CRM_Мероприятие
		|ГДЕ
		|	CRM_Мероприятие.Ссылка В(&Задачи)
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	ЗадачаИсполнителя.Исполнитель,
		|	ИСТИНА,
		// +++ VOG Кулаков П.Л. 24.03.2020 CRM-463
		|	0,
		|	0,
		// ++ VOG Солодов В.В. 24.12.2020 CRM-1098
		|	ЛОЖЬ
		// -- VOG Солодов В.В. 24.12.2020 CRM-1098
        // --- VOG Кулаков П.Л.
		|ИЗ
		|	Задача.ЗадачаИсполнителя КАК ЗадачаИсполнителя
		|ГДЕ
		|	ЗадачаИсполнителя.Ссылка В(&Задачи)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	CRM_МероприятиеСторонниеЛица.Ссылка КАК ЗадачаМероприятие,
		|	CRM_МероприятиеСторонниеЛица.Партнер КАК Клиент,
		|	CRM_МероприятиеСторонниеЛица.вогТорговаяТочка КАК ТорговаяТочка,
		|	CRM_МероприятиеСторонниеЛица.вогТорговаяТочка.Рынок КАК Рынок,
		|	ВЫРАЗИТЬ(CRM_МероприятиеСторонниеЛица.вогТорговаяТочка.МестоположениеНаРынке КАК СТРОКА(200)) КАК Расположение,
		|	CRM_МероприятиеСторонниеЛица.Ссылка.Ответственный КАК Сотрудник,
		|	ВЫБОР
		|		КОГДА CRM_МероприятиеСторонниеЛица.Ссылка.вогВидВзаимодействия = &ВстречаСКлиентом
		|				И CRM_МероприятиеСторонниеЛица.Ссылка.Помещение = &НейтральнаяТерритория
		|			ТОГДА CRM_МероприятиеСторонниеЛица.Ссылка.Город
		|		КОГДА CRM_МероприятиеСторонниеЛица.Ссылка.вогВидВзаимодействия = &ВстречаСКлиентом
		|				И CRM_МероприятиеСторонниеЛица.Ссылка.Помещение = &ОфисКлиента
		|			ТОГДА CRM_МероприятиеСторонниеЛица.Партнер.вогНаселенныйПункт
		|		КОГДА НЕ CRM_МероприятиеСторонниеЛица.Ссылка.Помещение = &ОфисКлиента
		|				И НЕ CRM_МероприятиеСторонниеЛица.Ссылка.Помещение = &НейтральнаяТерритория
		|			ТОГДА CRM_МероприятиеСторонниеЛица.Ссылка.Помещение.НаселенныйПункт
		|		ИНАЧЕ CRM_МероприятиеСторонниеЛица.вогТорговаяТочка.НаселенныйПункт
		|	КОНЕЦ КАК Город,
		|	ВЫБОР
		|		КОГДА CRM_МероприятиеСторонниеЛица.Ссылка.вогВидВзаимодействия = &ВстречаСКлиентом
		|				И CRM_МероприятиеСторонниеЛица.Ссылка.Помещение = &ОфисКлиента
		|			ТОГДА ПартнерыКонтактнаяИнформация.Представление
		|		КОГДА CRM_МероприятиеСторонниеЛица.Ссылка.вогВидВзаимодействия = &ВстречаСКлиентом
		|				И CRM_МероприятиеСторонниеЛица.Ссылка.Помещение = &НейтральнаяТерритория
		|			ТОГДА CRM_МероприятиеСторонниеЛица.Ссылка.АдресПредставление
		|		КОГДА НЕ CRM_МероприятиеСторонниеЛица.Ссылка.Помещение = &ОфисКлиента
		|				И НЕ CRM_МероприятиеСторонниеЛица.Ссылка.Помещение = &НейтральнаяТерритория
		|			ТОГДА CRM_МероприятиеСторонниеЛица.Ссылка.Помещение.Адрес
		|		ИНАЧЕ вогТорговыеТочкиКонтактнаяИнформация.Представление
		|	КОНЕЦ КАК АдресОфиса
		|ИЗ
		|	Документ.CRM_Мероприятие.СторонниеЛица КАК CRM_МероприятиеСторонниеЛица
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.вогТорговыеТочки.КонтактнаяИнформация КАК вогТорговыеТочкиКонтактнаяИнформация
		|		ПО CRM_МероприятиеСторонниеЛица.вогТорговаяТочка = вогТорговыеТочкиКонтактнаяИнформация.Ссылка
		|			И (вогТорговыеТочкиКонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.Месторасположение))
		|			И (НЕ вогТорговыеТочкиКонтактнаяИнформация.Представление = """")
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Партнеры.КонтактнаяИнформация КАК ПартнерыКонтактнаяИнформация
		|		ПО CRM_МероприятиеСторонниеЛица.Партнер = ПартнерыКонтактнаяИнформация.Ссылка
		|			И (ПартнерыКонтактнаяИнформация.Вид = &ВидМесторасположениеОфисаКлиента)
		|ГДЕ
		|	CRM_МероприятиеСторонниеЛица.Ссылка В(&Задачи)";
	
	Запрос.УстановитьПараметр("Задачи", 							Объект.Задачи.Выгрузить(, "Задача"));
	Запрос.УстановитьПараметр("РольНаблюдатель", 					Справочники.вогРолиУчастникаМероприятия.ПолучитьСсылку(Новый УникальныйИдентификатор("3b4cd5e1-aa36-11e9-9b11-005056bcd3e3"))); //Павелко, CRM-318, 12.02.2020, роль Наблюдатель
	Запрос.УстановитьПараметр("ВстречаСКлиентом",					Справочники.CRM_ВидыВзаимодействий.ПолучитьСсылку(Новый УникальныйИдентификатор("b23f6567-97ed-11e9-9b11-005056bcd3e3")));
	Запрос.УстановитьПараметр("НейтральнаяТерритория", 				Справочники.CRM_Помещения.ПолучитьСсылку(Новый УникальныйИдентификатор("fc23ab04-aa36-11e9-9b11-005056bcd3e3")));
	Запрос.УстановитьПараметр("ОфисКлиента", 						Справочники.CRM_Помещения.ПолучитьСсылку(Новый УникальныйИдентификатор("eb5b1218-aa36-11e9-9b11-005056bcd3e3")));
	Запрос.УстановитьПараметр("ВидМесторасположениеОфисаКлиента",	Справочники.ВидыКонтактнойИнформации.МесторасположениеОфисаКлиента);
	
	//Павелко, Задача CRM-284, 11.02.2020+++
	Результаты = Запрос.ВыполнитьПакет();
	
	ТаблицаУчастников 	= Результаты[0].Выгрузить();
	ТаблицаСтороннихЛиц	= Результаты[1].Выгрузить();
	
	Для Каждого Строка Из Объект.Задачи Цикл
		
		Если Не ТипЗнч(Строка.Задача) = Тип("ДокументСсылка.CRM_Мероприятие") Тогда
			Продолжить;
		КонецЕсли;	
				
		НайденнаяСтрока = ТаблицаСтороннихЛиц.Найти(Строка.Задача, "ЗадачаМероприятие");
		Если Не НайденнаяСтрока = Неопределено Тогда
			ЗаполнитьЗначенияСвойств(Строка, НайденнаяСтрока);
		КонецЕсли;	
				
	КонецЦикла;
		
	Для Каждого Строка Из мКомандированныеСотрудники Цикл
		
		Если ТаблицаУчастников.Найти(Строка.Сотрудник, "Сотрудник") = Неопределено Тогда
			// +++ VOG Кулаков П.Л. 24.03.2020 CRM-463
			//ТаблицаУчастников.Добавить().Сотрудник = Строка.Сотрудник;	
			НоваяСтрока = ТаблицаУчастников.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока,Строка);
			// --- VOG Кулаков П.Л.
		КонецЕсли;
		
	КонецЦикла;
	
	// +++ VOG Кулаков П.Л. 24.03.2020 CRM-463
	Для Каждого Строка Из ТаблицаУчастников Цикл
		Если Строка.Сумма <> 0 И Строка.КоличествоДней <> 0 Тогда
			Продолжить;
		КонецЕсли;
		
		Если Строка.Сотрудник = Справочники.Пользователи.Водитель Тогда
			Продолжить;
		КонецЕсли;
		
		Строка.КоличествоДней = Объект.Продолжительность;
		Строка.Сумма = РассчитатьСуммуКомандировочных(Строка.КоличествоДней,Строка.Сотрудник,Объект.ВремяНачала)
	КонецЦикла;	
	// --- VOG Кулаков П.Л.
	
	Объект.КомандированныеСотрудники.Загрузить(ТаблицаУчастников);
	//Павелко, Задача CRM-284, 11.02.2020---
	
КонецПроцедуры

// +++ VOG Кулаков П.Л. 17.03.2020 CRM-463
Функция РассчитатьСуммуКомандировочных(Знач Продолжительность,Сотрудник,ВремяНачала)
	
	Сумма = 0;
	// +++ VOG Кулаков П.Л. 28.07.2020 CRM-808
	Если Продолжительность = 1 Тогда
		Продолжительность = 0;
	КонецЕсли;	
	// --- VOG Кулаков П.Л.
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	Пользователи.Ссылка КАК Сотрудник,
		|	ЕСТЬNULL(вогРазмерСуточныхСрезПоследних.Размер, 0) КАК Размер,
		|	ЕСТЬNULL(вогРазмерСуточныхСрезПоследних.Размер, 0) * &Продолжительность КАК Сумма
		|ИЗ
		|	Справочник.Пользователи КАК Пользователи
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.вогРазмерСуточных.СрезПоследних(&ДатаКомандировки, ) КАК вогРазмерСуточныхСрезПоследних
		|		ПО Пользователи.CRM_ДолжностнаяПозиция.Суточные = вогРазмерСуточныхСрезПоследних.Вид
		|ГДЕ
		|	Пользователи.Ссылка = &Сотрудник";
	
	Запрос.УстановитьПараметр("Сотрудник", Сотрудник);
	Запрос.УстановитьПараметр("ДатаКомандировки", ВремяНачала);
	Запрос.УстановитьПараметр("Продолжительность", Продолжительность);
	
	РезультатЗапроса = Запрос.Выполнить().Выбрать();
	Если РезультатЗапроса.Следующий() Тогда
		Сумма = РезультатЗапроса.Сумма;
	КонецЕсли;
	
	Возврат Сумма;
	
КонецФункции // --- VOG Кулаков П.Л.

#КонецЕсли
