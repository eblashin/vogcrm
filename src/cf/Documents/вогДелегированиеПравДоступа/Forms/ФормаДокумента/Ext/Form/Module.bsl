
// + Тищенко В.В.

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	
	Если Объект.Ссылка.Пустая() Тогда
		Объект.ВладелецРоли = Пользователи.ТекущийПользователь();
	КонецЕсли;
	
	Объект.ДействуетС = НачалоДня(ТекущаяДата()) + 43200;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ВыбратьПериод(Команда)
	
	НовыйПериод = Новый СтандартныйПериод(Объект.ДействуетС, ?(Объект.ДействуетПо='00010101',Объект.ДействуетПо,КонецДня(Объект.ДействуетС)));
	
	ФормаРедактирования 							= ПолучитьФорму("ОбщаяФорма.CRM_ФормаРедактированияПроизвольногоПериода");
	ФормаРедактирования.Период 						= НовыйПериод;
	ФормаРедактирования.ОписаниеОповещенияОЗакрытии = Новый ОписаниеОповещения("ПолеБыстрогоОтбора_ПериодПриИзмененииЗавершение", ЭтаФорма);
	ФормаРедактирования.РежимОткрытияОкна 			= РежимОткрытияОкнаФормы.БлокироватьОкноВладельца;
	ФормаРедактирования.Открыть();
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДоступныеРоли(Команда)
	ЗаполнитьДоступныеРолиСервер();
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Процедура ПолеБыстрогоОтбора_ПериодПриИзмененииЗавершение(НовыйПериод, ДополнительныеПараметры) Экспорт
	
	Если НовыйПериод = Неопределено ИЛИ НовыйПериод = КодВозвратаДиалога.Отмена Тогда
		Возврат
	КонецЕсли;	
	
	Объект.ДействуетС 	= НовыйПериод.ДатаНачала;
	Объект.ДействуетПо 	= НовыйПериод.ДатаОкончания;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьДоступныеРолиСервер()

	Объект.ДоступныеРолиИсполнителя.Очистить();
	
	Запрос = Новый Запрос("ВЫБРАТЬ
	|	ИсполнителиЗадач.РольИсполнителя КАК РольИсполнителя
	|ИЗ
	|	РегистрСведений.ИсполнителиЗадач КАК ИсполнителиЗадач
	|ГДЕ
	|	ИсполнителиЗадач.Исполнитель = &Исполнитель");
	Запрос.УстановитьПараметр("Исполнитель",Объект.ВладелецРоли);
	Объект.ДоступныеРолиИсполнителя.Загрузить(Запрос.Выполнить().Выгрузить());
	
КонецПроцедуры
 
#КонецОбласти

// - Тищенко В.В.

