
#Область ПрограммныйИнтерфейс

Функция GetUniversalData(CurrentValue)

	ИсходящиеДанные 	= Новый Соответствие;
	ВходящиеДанные 		= вогОбщегоНазначения.ДесериализоватьОбъект(CurrentValue);
	
	Если ТипЗнч(ВходящиеДанные) <> Тип("Структура")
		Или ВходящиеДанные.Количество() = 0
		Или Не ВходящиеДанные.Свойство("ДанныеЗагрузки")
		Или Не ВходящиеДанные.Свойство("ОбработчикЗагрузки")
		Или Не ВходящиеДанные.Свойство("ОбработчикВыгрузки") Тогда
		
		Возврат Новый ХранилищеЗначения(ИсходящиеДанные, Новый СжатиеДанных(9));
		
	КонецЕсли;
	
	ТекстОшибки = "";
	Результат 	= Новый Структура;
	Результат.Вставить("ВыполненоУспешно", Ложь);
	
	// Обработка входящих данных
	Если ЗначениеЗаполнено(ВходящиеДанные.ОбработчикЗагрузки) Тогда
		
		ДанныеЗагрузки = ВходящиеДанные.ДанныеЗагрузки;
		
		Попытка
			Выполнить(ВходящиеДанные.ОбработчикЗагрузки);
		Исключение
			ТекстОшибки = ОписаниеОшибки();
			ЗаписьЖурналаРегистрации(
				"Обмен с учетной системой. Универсальный обработчик. Обработка входящих данных",
				УровеньЖурналаРегистрации.Ошибка,
				,
				,
				ТекстОшибки);
		КонецПопытки;
		
	КонецЕсли;
	
	// Обработка исходящих данных
	Если ЗначениеЗаполнено(ВходящиеДанные.ОбработчикВыгрузки) Тогда
		
		Попытка
			Выполнить(ВходящиеДанные.ОбработчикВыгрузки);
		Исключение
			ТекстОшибки = ОписаниеОшибки();
			ЗаписьЖурналаРегистрации(
				"Обмен с учетной системой. Универсальный обработчик. Обработка исходящих данных",
				УровеньЖурналаРегистрации.Ошибка,
				,
				,
				ТекстОшибки);
		КонецПопытки;
		
	КонецЕсли;
	
	Результат.Вставить("ОписаниеОшибки", ТекстОшибки);
	ИсходящиеДанные.Вставить("РезультатЗагрузки", Результат);
	
	Возврат Новый ХранилищеЗначения(ИсходящиеДанные, Новый СжатиеДанных(9));
	
КонецФункции

#КонецОбласти

#Область ВспомогательныеПроцедурыФункции

#КонецОбласти
