#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда


Процедура ЗарегистрироватьРазрегистрироватьОбъекты(МассивТипов, Зарегистрировать, ПериодНачало = Неопределено, ПериодОкончание = Неопределено) Экспорт
	Если МассивТипов.Количество() = 0 Тогда Возврат; КонецЕсли;
	
	Если Зарегистрировать Тогда
		ТекстЗапроса = "";
		
		Для нИндекс = 0 По МассивТипов.ВГраница() Цикл
			Тип = МассивТипов[нИндекс];
			
			ПолноеИмя = Метаданные.НайтиПоТипу(Тип).Имя;
			Если Не ЗначениеЗаполнено(ПолноеИмя) Тогда Продолжить; КонецЕсли;
			
			ТекстЗапроса = ТекстЗапроса + "ВЫБРАТЬ Ссылка КАК Ссылка
			|
			|ИЗ Документ." + ПолноеИмя + "
			|";
			
			Если ЗначениеЗаполнено(ПериодНачало) Или ЗначениеЗаполнено(ПериодОкончание) Тогда
				бЕстьДата = Ложь;
				МетаданныеОбъекта = Метаданные.НайтиПоПолномуИмени(ПолноеИмя);
				Попытка
					ТестоваяПеременная = МетаданныеОбъекта.СтандартныеРеквизиты.Дата;
					бЕстьДата = Истина;
				Исключение КонецПопытки;
				Если Не бЕстьДата Тогда
					Попытка
						ТестоваяПеременная = МетаданныеОбъекта.Реквизиты.Дата;
						бЕстьДата = Истина;
					Исключение КонецПопытки;
				КонецЕсли;
				
				Если бЕстьДата Тогда
					Если ЗначениеЗаполнено(ПериодНачало) И ЗначениеЗаполнено(ПериодОкончание) Тогда
						ТекстЗапроса = ТекстЗапроса + "
						| ГДЕ Дата МЕЖДУ &ПериодНачало И &ПериодОкончание"
					ИначеЕсли ЗначениеЗаполнено(ПериодНачало) Тогда
						ТекстЗапроса = ТекстЗапроса + "
						| ГДЕ Дата >= &ПериодНачало"
					ИначеЕсли ЗначениеЗаполнено(ПериодОкончание) Тогда
						ТекстЗапроса = ТекстЗапроса + "
						| ГДЕ Дата <= &ПериодОкончание"
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
			
			Если нИндекс <> МассивТипов.ВГраница() Тогда
				ТекстЗапроса = ТекстЗапроса + "
				|
				|ОБЪЕДИНИТЬ ВСЕ
				|"
			КонецЕсли;
			
		КонецЦикла;
		
	Иначе
		ТекстЗапроса = "ВЫБРАТЬ Объект КАК Ссылка ИЗ РегистрСведений.CRM_СостоянияВоронкиПродаж ГДЕ Объекта В (&МассивОбъектов)";
		
		
	КонецЕсли;
	
	Запрос = Новый Запрос(ТекстЗапроса);
	ПараметрыЗапроса = Запрос.НайтиПараметры();
	Если ПараметрыЗапроса.Найти("ПериодНачало") <> Неопределено Тогда
		Запрос.УстановитьПараметр("ПериодНачало", ПериодНачало);
	КонецЕсли;
	Если ПараметрыЗапроса.Найти("ПериодОкончание") <> Неопределено Тогда
		Запрос.УстановитьПараметр("ПериодОкончание", ПериодОкончание);
	КонецЕсли;
	Если ПараметрыЗапроса.Найти("МассивТипов") <> Неопределено Тогда
		Запрос.УстановитьПараметр("МассивТипов", МассивТипов);
	КонецЕсли;
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		Если Зарегистрировать Тогда
			CRM_ВоронкиПродажСервер.ПриЗаписиОбъектаВоронкиПродаж(Выборка.Ссылка, Ложь);
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры


#КонецЕсли