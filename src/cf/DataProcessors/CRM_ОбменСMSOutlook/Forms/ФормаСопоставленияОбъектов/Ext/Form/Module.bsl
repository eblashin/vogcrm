&НаКлиенте
Перем мСтруктураСвойств;

&НаКлиенте
Перем мНастройка;

// Общие процедуры и функции 
&НаСервере
Функция ПолучитьМассивСтруктурКонтактов()
	
	ТЗ = мКонтакты.Выгрузить();
	
	Возврат ОбщегоНазначения.ТаблицаЗначенийВМассив(ТЗ);
	
КонецФункции

&НаСервере
Функция ПолучитьМассивСтруктурСобытий()
	
	ТЗ = мСобытия.Выгрузить();
	
	Возврат ОбщегоНазначения.ТаблицаЗначенийВМассив(ТЗ);
	
КонецФункции

&НаСервере
Функция ПолучитьМассивСтруктурПисем()
	
	ТЗ = мПисьма.Выгрузить();
	
	Возврат ОбщегоНазначения.ТаблицаЗначенийВМассив(ТЗ);
	
КонецФункции

&НаКлиенте
Процедура ВыборОбъектаOutlookКонтакты(Элемент)
	
	//Если мТаблицаКонтактовOutlook.Количество() = 0  Тогда
	//	ПолучитьВСЕКонтактыOutlook();
	//КонецЕсли;	
	//
	
	ТекущиеДанные = ТекущийЭлемент.ТекущиеДанные;
	
	МассивСтрок = CRM_ОбменСMSOutlookКлиентСервер.НайтиСтроки(мСтруктураСвойств.ТаблицаКонтактовOutlook,
		Новый Структура("ВидКонтакта", ТекущиеДанные.ВидКонтакта)
	);
	СписокДляВыбора = Новый СписокЗначений;
		
	Для Каждого ЭлементМассива Из МассивСтрок Цикл
		СписокДляВыбора.Добавить(ЭлементМассива,ЭлементМассива.Представление_Outlook);
	КонецЦикла;
	
	Если СписокДляВыбора.Количество() = 0 Тогда
		
		Возврат;
		
	КонецЕсли;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ВыборОбъектаOutlookКонтактыЗавершение", ЭтотОбъект, ТекущиеДанные);
	ПоказатьВыборИзСписка(ОписаниеОповещения, СписокДляВыбора,Элемент);
	
КонецПроцедуры

&НаКлиенте
Процедура ВыборОбъектаOutlookКонтактыЗавершение(Результат, ТекущиеДанные) Экспорт
	
	Если НЕ Результат = Неопределено Тогда
		
		// обновим текущие данные
	//	ТекущиеДанные.ID_1С			= Результат.Ссылка.CustomerID;
		ТекущиеДанные.Представление_Outlook		= Результат.Значение.Представление_Outlook;
		ТекущиеДанные.ПапкаOutlook				= Результат.Значение.FolderName;
		ТекущиеДанные.ДатаИзменения_Outlook		= Результат.Значение.ДатаИзменения;
		
		// Возможно объект уже есть в списке, нужно его удалить.
		МассивСтрокСОМОбъекта =  CRM_ОбменСMSOutlookКлиентСервер.НайтиСтроки(мСтруктураСвойств.СОМОбъектыКонтактов,
			Новый Структура("ОбъектOutlookID",Результат.Значение.ОбъектOutlookID));
		
		Для	каждого СтрокаСОМОбъекта Из МассивСтрокСОМОбъекта Цикл
			
			Если  СтрокаСОМОбъекта.СтрокаТЧ =  ТекущиеДанные.ID Тогда
				
				мСтроки = мКонтакты.НайтиСтроки(
					Новый Структура("ID",
							СтрокаСОМОбъекта.СтрокаТЧ)
				);
				
				Если мСтроки.Количество() > 0 Тогда 
					
					мКонтакты.Удалить(мСтроки[0]);
					
				КонецЕсли;
				
			КонецЕсли;	
			
		КонецЦикла;
		
		СтрокаСОМОбъекта			= CRM_ОбменСMSOutlookКлиентСервер.ПолучитьСтруктуруТаблицыCOMОбъектовКонтактов();
		СтрокаСОМОбъекта.СтрокаТЧ		= ТекущиеДанные.ID;
		СтрокаСОМОбъекта.ОбъектOutlook	= Результат.Значение.ОбъектOutlook.ОбъектOutlook;
		мСтруктураСвойств.СОМОбъектыКонтактов.Добавить(СтрокаСОМОбъекта);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВыборНаправленияОбмена(Элемент,СтандартнаяОбработка)
	
	СпсикоВыбора = Новый СписокЗначений;
	СпсикоВыбора.Добавить("1С -> Outlook", "1С -> Outlook");
	СпсикоВыбора.Добавить("Outlook -> 1С", "Outlook -> 1С");
	ТекущееНаправление = ТекущийЭлемент.ТекущиеДанные.Направление;
	ОписаниеОповещения = Новый ОписаниеОповещения("ВыборНаправленияОбменаЗавершение", ЭтотОбъект);
	ПоказатьВыборИзСписка(ОписаниеОповещения, СпсикоВыбора,Элемент,?(ТекущееНаправление = "Outlook -> 1С",0,1));
	
КонецПроцедуры

&НаКлиенте
Процедура ВыборНаправленияОбменаЗавершение(ВыбранноеЗначение, ДополнительныеПараметры) Экспорт
	
	Если  ВыбранноеЗначение<>Неопределено Тогда
		ТекущийЭлемент.ТекущиеДанные.Направление = ВыбранноеЗначение;
	КонецЕсли;
	
КонецПроцедуры

// События формы

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	мСтруктураСвойств	= CRM_ОбменСMSOutlookКлиент.ПолучитьСтруктуруСвойств();
	ЗаполнитьЗначенияСвойств(мСтруктураСвойств, СтруктураСвойств);
	мСтруктураСвойств.СОМОбъектыКонтактов	= СтруктураСвойств.COMОбъектыКонтактов;
	мСтруктураСвойств.СОМОбъектыСобытий		= СтруктураСвойств.COMОбъектыСобытий;
	мСтруктураСвойств.СОМОбъектыПисем		= СтруктураСвойств.COMОбъектыПисем;
	ТекстОшибки = "";
	мНастройка = Настройка;
	#Если НЕ ВебКлиент Тогда
	мНастройка.Вставить("ИмяКомпьютера", ИмяКомпьютера());
	#КонецЕсли
	Если НЕ CRM_ОбменСMSOutlookКлиент.ПолучитьOutlookObj(мСтруктураСвойств, мНастройка, ТекстОшибки) Тогда
		Отказ = Истина;
		Если ЗначениеЗаполнено(ТекстОшибки) Тогда
			ПоказатьПредупреждение(, ТекстОшибки);
		КонецЕсли;
		Возврат;
	КонецЕсли;
	CRM_ОбменСMSOutlookКлиент.ВосстановитьТаблицуCOMОбъектов(мСтруктураСвойств.OutlookObj,
		мСтруктураСвойств.СОМОбъектыКонтактов, мСтруктураСвойств.СоответствиеСОМОбъектыКонтактов);
	CRM_ОбменСMSOutlookКлиент.ВосстановитьТаблицуОбъектовOutlook(мСтруктураСвойств.OutlookObj,
		мСтруктураСвойств.ТаблицаКонтактовOutlook);
	Для Каждого СтрокаТаблицы Из мКонтакты Цикл
		Если СтрокаТаблицы.ВидКонтакта = "КЛК" Тогда
			СтрокаТаблицы.ОтборСтрок = 1;
		ИначеЕсли СтрокаТаблицы.ВидКонтакта = "К" Тогда
			СтрокаТаблицы.ОтборСтрок = 2;
		КонецЕсли;
	КонецЦикла;
	Элементы.ТаблицаКЛК.ОтборСтрок	= Новый ФиксированнаяСтруктура("ОтборСтрок", 1);
	Элементы.ТаблицаК.ОтборСтрок	= Новый ФиксированнаяСтруктура("ОтборСтрок", 2);
	Элементы.ТаблицаКЛК.Обновить();
	Элементы.ТаблицаК.Обновить();
	CRM_ОбменСMSOutlookКлиент.ВосстановитьТаблицуCOMОбъектов(мСтруктураСвойств.OutlookObj,
		мСтруктураСвойств.СОМОбъектыСобытий, мСтруктураСвойств.СоответствиеСОМОбъектыСобытий);
	CRM_ОбменСMSOutlookКлиент.ВосстановитьТаблицуОбъектовOutlook(мСтруктураСвойств.OutlookObj,
		мСтруктураСвойств.ТаблицаСобытийOutlook);
	CRM_ОбменСMSOutlookКлиент.ВосстановитьТаблицуCOMОбъектов(мСтруктураСвойств.OutlookObj,
		мСтруктураСвойств.СОМОбъектыПисем, мСтруктураСвойств.СоответствиеСОМОбъектыПисем);
	CRM_ОбменСMSOutlookКлиент.ВосстановитьТаблицуОбъектовOutlook(мСтруктураСвойств.OutlookObj,
		мСтруктураСвойств.ТаблицаПисемOutlook);
	мСтруктураСвойств.ТаблицаПапокOutlook = СтруктураСвойств.ТаблицаПапокOutlook;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если НЕ Параметры.Свойство("ЗначенияЗаполнения") Тогда
		Отказ = Истина;
	ИначеЕсли НЕ (ТипЗнч(Параметры.ЗначенияЗаполнения) = Тип("Структура")) Тогда
		Отказ = Истина;
	ИначеЕсли НЕ Параметры.ЗначенияЗаполнения.Свойство("СтруктураСвойств") Тогда 
		Отказ = Истина;
	Иначе
		СтруктураСвойств	= Параметры.ЗначенияЗаполнения.СтруктураСвойств;
		Настройка			= Параметры.ЗначенияЗаполнения.Настройка;
		Письма		= СтруктураСвойств.Письма;
		Контакты	= СтруктураСвойств.Контакты;
		События		= СтруктураСвойств.События;
		ТЗПисьма	= CRM_ОбменСMSOutlookСервер.МассивСтруктурВТаблицуЗначений(Письма);
		ТЗКонтакты	= CRM_ОбменСMSOutlookСервер.МассивСтруктурВТаблицуЗначений(Контакты);
		ТЗСобытия	= CRM_ОбменСMSOutlookСервер.МассивСтруктурВТаблицуЗначений(События);
		мКонтакты.Загрузить(ТЗКонтакты);
		мСобытия.Загрузить(ТЗСобытия);
		мПисьма.Загрузить(ТЗПисьма);
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ТаблицаКНаправлениеНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ВыборНаправленияОбмена(Элемент,СтандартнаяОбработка);
	
КонецПроцедуры

&НаКлиенте
Процедура ТаблицаКЛКНаправлениеНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ВыборНаправленияОбмена(Элемент,СтандартнаяОбработка);
	
КонецПроцедуры

&НаКлиенте
Процедура СобытияНаправлениеНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ВыборНаправленияОбмена(Элемент,СтандартнаяОбработка);
	
КонецПроцедуры

&НаКлиенте
Процедура ПисьмаНаправлениеНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ВыборНаправленияОбмена(Элемент,СтандартнаяОбработка);
	
КонецПроцедуры

&НаКлиенте
Процедура ТаблицаКЛКПредставление_OutlookНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ВыборОбъектаOutlookКонтакты(Элемент);
	
КонецПроцедуры

&НаКлиенте
Процедура ТаблицаКПредставление_OutlookНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	ВыборОбъектаOutlookКонтакты(Элемент);
	
КонецПроцедуры

&НаКлиенте
Процедура СобытияПредставление_OutlookНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	ТекущиеДанные	= ТекущийЭлемент.ТекущиеДанные;
	СписокДляВыбора	= Новый СписокЗначений;
	Для Каждого ЭлементМассива Из мСтруктураСвойств.ТаблицаСобытийOutlook Цикл
		СписокДляВыбора.Добавить(ЭлементМассива, ЭлементМассива.Представление_Outlook);
	КонецЦикла;
	ОписаниеОповещения = Новый ОписаниеОповещения("СобытияПредставление_OutlookНачалоВыбораИзСпискаЗавершение", ЭтотОбъект, ТекущиеДанные);
	ПоказатьВыборИзСписка(ОписаниеОповещения, СписокДляВыбора, Элемент);
КонецПроцедуры

&НаКлиенте
Процедура СобытияПредставление_OutlookНачалоВыбораИзСпискаЗавершение(Результат, ТекущиеДанные) Экспорт
	Если НЕ (Результат = Неопределено) Тогда
		// Обновим текущие данные
		ТекущиеДанные.Представление_Outlook		= Результат.Значение.Представление_Outlook;
		ТекущиеДанные.ПапкаOutlook				= Результат.Значение.FolderName;
		ТекущиеДанные.ДатаИзменения_Outlook		= Результат.Значение.ДатаИзменения;
		// Возможно объект уже есть в списке, то нужно его удалить.
		МассивСтрокСОМОбъекта =  CRM_ОбменСMSOutlookКлиентСервер.НайтиСтроки(мСтруктураСвойств.СОМОбъектыСобытий,
			Новый Структура("ОбъектOutlookID", Результат.Значение.ОбъектOutlookID));
		Для	Каждого СтрокаСОМОбъекта Из МассивСтрокСОМОбъекта Цикл
			Если СтрокаСОМОбъекта.СтрокаТЧ = ТекущиеДанные.ID Тогда
				мСтроки = мКонтакты.НайтиСтроки(Новый Структура("ID", СтрокаСОМОбъекта.СтрокаТЧ));
				Если мСтроки.Количество() > 0 Тогда 
					мКонтакты.Удалить(мСтроки[0]);
				КонецЕсли;
			КонецЕсли;	
		КонецЦикла;
		СтрокаСОМОбъекта				= CRM_ОбменСMSOutlookКлиентСервер.ПолучитьСтруктуруТаблицыCOMОбъектовСобытий();
		СтрокаСОМОбъекта.СтрокаТЧ		= ТекущиеДанные.ID;
		СтрокаСОМОбъекта.ОбъектOutlook	= Результат.Значение.ОбъектOutlook.ОбъектOutlook;
		мСтруктураСвойств.СОМОбъектыКонтактов.Добавить(СтрокаСОМОбъекта);
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПисьмаПредставление_OutlookНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	ТекущиеДанные	= ТекущийЭлемент.ТекущиеДанные;
	СписокДляВыбора	= Новый СписокЗначений;
	Для Каждого ЭлементМассива Из мСтруктураСвойств.ТаблицаПисемOutlook Цикл
		СписокДляВыбора.Добавить(ЭлементМассива, ЭлементМассива.Представление_Outlook);
	КонецЦикла;
	ОписаниеОповещения = Новый ОписаниеОповещения("ПисьмаПредставление_OutlookНачалоВыбораИзСпискаЗавершение", ЭтотОбъект, ТекущиеДанные);
	ПоказатьВыборИзСписка(ОписаниеОповещения, СписокДляВыбора, Элемент);
КонецПроцедуры

&НаКлиенте
Процедура ПисьмаПредставление_OutlookНачалоВыбораИзСпискаЗавершение(Результат, ТекущиеДанные) Экспорт
	Если НЕ (Результат = Неопределено) Тогда
		// Обновим текущие данные
		ТекущиеДанные.Представление_Outlook		= Результат.Значение.Представление_Outlook;
		ТекущиеДанные.ПапкаOutlook				= Результат.Значение.FolderName;
		ТекущиеДанные.ДатаИзменения_Outlook		= Результат.Значение.ДатаИзменения;
		// Возможно объект уже есть в списке, нужно его удалить.
		МассивСтрокСОМОбъекта =  CRM_ОбменСMSOutlookКлиентСервер.НайтиСтроки(мСтруктураСвойств.СОМОбъектыПисем,
			Новый Структура("ОбъектOutlookID", Результат.Значение.ОбъектOutlookID));
		Для	Каждого СтрокаСОМОбъекта Из МассивСтрокСОМОбъекта Цикл
			Если СтрокаСОМОбъекта.СтрокаТЧ = ТекущиеДанные.ID Тогда
				мСтроки = мКонтакты.НайтиСтроки(Новый Структура("ID", СтрокаСОМОбъекта.СтрокаТЧ));
				Если мСтроки.Количество() > 0 Тогда 
					мКонтакты.Удалить(мСтроки[0]);
				КонецЕсли;
			КонецЕсли;	
		КонецЦикла;
		СтрокаСОМОбъекта				= CRM_ОбменСMSOutlookКлиентСервер.ПолучитьСтруктуруТаблицыCOMОбъектовПисем();
		СтрокаСОМОбъекта.СтрокаТЧ		= ТекущиеДанные.ID;
		СтрокаСОМОбъекта.ОбъектOutlook	= Результат.Значение.ОбъектOutlook.ОбъектOutlook;
		мСтруктураСвойств.СОМОбъектыКонтактов.Добавить(СтрокаСОМОбъекта);
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ВосстановитьCOMОбъекты()
	
	CRM_ОбменСMSOutlookКлиент.ВосстановитьТаблицуCOMОбъектов(мСтруктураСвойств.OutlookObj,мСтруктураСвойств.СОМОбъектыКонтактов, мСтруктураСвойств.СоответствиеСОМОбъектыКонтактов);
	
	CRM_ОбменСMSOutlookКлиент.ВосстановитьТаблицуОбъектовOutlook(мСтруктураСвойств.OutlookObj,мСтруктураСвойств.ТаблицаКонтактовOutlook);
	
	CRM_ОбменСMSOutlookКлиент.ВосстановитьТаблицуCOMОбъектов(мСтруктураСвойств.OutlookObj,мСтруктураСвойств.СОМОбъектыСобытий, мСтруктураСвойств.СоответствиеСОМОбъектыСобытий);
	
	CRM_ОбменСMSOutlookКлиент.ВосстановитьТаблицуОбъектовOutlook(мСтруктураСвойств.OutlookObj,мСтруктураСвойств.ТаблицаСобытийOutlook);
	
	CRM_ОбменСMSOutlookКлиент.ВосстановитьТаблицуCOMОбъектов(мСтруктураСвойств.OutlookObj,мСтруктураСвойств.СОМОбъектыПисем, мСтруктураСвойств.СоответствиеСОМОбъектыПисем);
	
	CRM_ОбменСMSOutlookКлиент.ВосстановитьТаблицуОбъектовOutlook(мСтруктураСвойств.OutlookObj,мСтруктураСвойств.ТаблицаПисемOutlook);
	
КонецПроцедуры

&НаКлиенте
Процедура ПодготовитьCOMОбъекты()
		
	CRM_ОбменСMSOutlookКлиент.ПодготовитьТаблицуCOMОбъектовOutlook(мСтруктураСвойств.СОМОбъектыКонтактов);
	
	CRM_ОбменСMSOutlookКлиент.ПодготовитьТаблицуОбъектовOutlook(мСтруктураСвойств.ТаблицаКонтактовOutlook);
	
	CRM_ОбменСMSOutlookКлиент.ПодготовитьТаблицуCOMОбъектовOutlook(мСтруктураСвойств.СОМОбъектыСобытий);
	
	CRM_ОбменСMSOutlookКлиент.ПодготовитьТаблицуОбъектовOutlook(мСтруктураСвойств.ТаблицаСобытийOutlook);
	
	CRM_ОбменСMSOutlookКлиент.ПодготовитьТаблицуCOMОбъектовOutlook(мСтруктураСвойств.СОМОбъектыПисем);
	
	CRM_ОбменСMSOutlookКлиент.ПодготовитьТаблицуОбъектовOutlook(мСтруктураСвойств.ТаблицаПисемOutlook);
	
КонецПроцедуры

// Команды формы

&НаКлиенте
Процедура КомандаПродолжить(Команда)
	ТекстОшибки = "";
	СтруктураСвойств = Неопределено;
	Если НЕ CRM_ОбменСMSOutlookКлиент.ПолучитьOutlookObj(мСтруктураСвойств, мНастройка, ТекстОшибки) Тогда
		Если ЗначениеЗаполнено(ТекстОшибки) Тогда
			ПоказатьПредупреждение(, ТекстОшибки);
		КонецЕсли;
		Возврат;
	КонецЕсли;
	ПодготовитьCOMОбъекты();
	мТаблицаКонтакты	= Новый Массив();
	мТаблицаКонтакты	= ПолучитьМассивСтруктурКонтактов();
	мТаблицаСобытия		= Новый Массив();
	мТаблицаСобытия		= ПолучитьМассивСтруктурСобытий();
	мТаблицаПисьма		= Новый Массив();
	мТаблицаПисьма		= ПолучитьМассивСтруктурПисем();
	мСтруктураСвойств.Вставить("Контакты",	мТаблицаКонтакты);
	мСтруктураСвойств.Вставить("События",	мТаблицаСобытия);
	мСтруктураСвойств.Вставить("Письма",	мТаблицаПисьма);
	ВосстановитьCOMОбъекты();
	CRM_ОбменСMSOutlookКлиент.СинхронизироватьКонтакты(мСтруктураСвойств,	мНастройка);
	CRM_ОбменСMSOutlookКлиент.СинхронизироватьСобытия(мСтруктураСвойств,	мНастройка);
	CRM_ОбменСMSOutlookКлиент.СинхронизироватьПисьма(мСтруктураСвойств,		мНастройка);
	ДатыСинхронизации = Новый Структура("ДатаПоследнейСинхронизацииКонтактов,ДатаПоследнейСинхронизацииПисем,ДатаПоследнейСинхронизацииСобытий");
	Попытка
		ЗаполнитьЗначенияСвойств(ДатыСинхронизации, мСтруктураСвойств);
		CRM_ОбменСMSOutlookКлиент.СохранитьДатуСинхронизацииДляТекущейБазыOutlook(мНастройка.ПрограммаOutlook, мСтруктураСвойств);
	Исключение КонецПопытки;
	Закрыть(ДатыСинхронизации);
КонецПроцедуры

&НаКлиенте
Процедура УстановитьСнятьФлажки(ИмяТаблицы, Установить, ИмяЭлемента = Неопределено)
	Для Каждого СтрокаТаблицы Из ЭтотОбъект[ИмяТаблицы] Цикл
		Если ИмяЭлемента <> Неопределено Тогда
			Если ТипЗнч(Элементы[ИмяЭлемента].ОтборСтрок) = Тип("ФиксированнаяСтруктура") Тогда
				бСоответствуетОтбору = Истина;
				Для Каждого КлючЗначение Из Элементы[ИмяЭлемента].ОтборСтрок Цикл
					Попытка
						Если СтрокаТаблицы[КлючЗначение.Ключ] <> КлючЗначение.Значение Тогда
							бСоответствуетОтбору = Ложь;
							Прервать;
						КонецЕсли;
					Исключение
						бСоответствуетОтбору = Ложь;
						Прервать;
					КонецПопытки;
				КонецЦикла;
				Если Не бСоответствуетОтбору Тогда
					Продолжить;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		
		СтрокаТаблицы.Пометка = Установить;
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Процедура КомандаУстановитьФлажки(Команда)
	Если Элементы.ПанельЭтапов.ТекущаяСтраница = Элементы.СтраницаСобытия Тогда
		УстановитьСнятьФлажки("мСобытия", Истина);
	ИначеЕсли Элементы.ПанельЭтапов.ТекущаяСтраница = Элементы.СтраницаКонтакты Тогда
		Если Элементы.СтраницыСинхронизации.ТекущаяСтраница = Элементы.СинхронизацияКЛК Тогда
			УстановитьСнятьФлажки("мКонтакты", Истина, "ТаблицаКЛК");
		ИначеЕсли Элементы.СтраницыСинхронизации.ТекущаяСтраница = Элементы.СинхронизацияК Тогда
			УстановитьСнятьФлажки("мКонтакты", Истина, "ТаблицаК");
		КонецЕсли;
	ИначеЕсли Элементы.ПанельЭтапов.ТекущаяСтраница = Элементы.СтраницаПочта Тогда
		УстановитьСнятьФлажки("мПисьма", Истина);
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура КомандаСнятьФлажки(Команда)
	Если Элементы.ПанельЭтапов.ТекущаяСтраница = Элементы.СтраницаСобытия Тогда
		УстановитьСнятьФлажки("мСобытия", Ложь);
	ИначеЕсли Элементы.ПанельЭтапов.ТекущаяСтраница = Элементы.СтраницаКонтакты Тогда
		Если Элементы.СтраницыСинхронизации.ТекущаяСтраница = Элементы.СинхронизацияКЛК Тогда
			УстановитьСнятьФлажки("мКонтакты", Ложь, "ТаблицаКЛК");
		ИначеЕсли Элементы.СтраницыСинхронизации.ТекущаяСтраница = Элементы.СинхронизацияК Тогда
			УстановитьСнятьФлажки("мКонтакты", Ложь, "ТаблицаК");
		КонецЕсли;
	ИначеЕсли Элементы.ПанельЭтапов.ТекущаяСтраница = Элементы.СтраницаПочта Тогда
		УстановитьСнятьФлажки("мПисьма", Ложь);
	КонецЕсли;
КонецПроцедуры
