
&НаСервере
Процедура ЗаполнитьТаблицуСоответствиеОбъектовСервер(ТаблицаСинхронизируемыхОбъектов1С, ПрограммаOutlook, ПоОбъектамMSOutlook = Ложь)
	СоответствиеОбъектов.Очистить();
	МассивСсылок = Новый Массив();
	Для Каждого СтрокаТаблицы Из ТаблицаСинхронизируемыхОбъектов1С Цикл
		Если ПоОбъектамMSOutlook Тогда
			МассивСсылок = ТаблицаСинхронизируемыхОбъектов1С;
		Иначе
			Если ЗначениеЗаполнено(СтрокаТаблицы.Ссылка) Тогда
				МассивСсылок.Добавить(СтрокаТаблицы.Ссылка);
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	Если МассивСсылок.Количество() > 0 Тогда
		Запрос = Новый Запрос("
		|ВЫБРАТЬ
		|	СобственнаяСсылка КАК СобственнаяСсылка,
		|	СсылкаВOutlook КАК СсылкаВOutlook,
		|	ВЫРАЗИТЬ(СобственнаяСсылка КАК Документ.CRM_Мероприятие).Дата КАК Дата
		|ИЗ
		|	РегистрСведений.CRM_СоответствиеОбъектовOutlook
		|ГДЕ
		|	ПрограммаOutlook = &ПрограммаOutlook
		|	И " + ?(ПоОбъектамMSOutlook, "СсылкаВOutlook В (&МассивСсылок)", "СобственнаяСсылка В (&МассивСсылок)") + "
		|");
		Запрос.УстановитьПараметр("ПрограммаOutlook", ПрограммаOutlook);
		Запрос.УстановитьПараметр("МассивСсылок", МассивСсылок);
		Таблица = Запрос.Выполнить().Выгрузить();
		ЗначениеВРеквизитФормы(Таблица, "СоответствиеОбъектов");
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьТаблицуКонтактыСобытийСервер(События) Экспорт
	МассивСобытий = Новый Массив();
	Для Каждого СтрокаТаблицы Из События Цикл
		Если СтрокаТаблицы.Пометка И ЗначениеЗаполнено(СтрокаТаблицы.Объект_1С) Тогда
			МассивСобытий.Добавить(СтрокаТаблицы.Объект_1С);
		КонецЕсли;
	КонецЦикла;
	
	Запрос = Новый Запрос("
	|	ВЫБРАТЬ
	|	СторонниеЛица.Ссылка КАК Событие,
	|	ВЫБОР
	|		КОГДА СторонниеЛица.КонтактноеЛицо ССЫЛКА Справочник.КонтактныеЛицаПартнеров
	|				И СторонниеЛица.КонтактноеЛицо <> ЗНАЧЕНИЕ(Справочник.КонтактныеЛицаПартнеров.ПустаяСсылка)
	|			ТОГДА СторонниеЛица.КонтактноеЛицо
	|		ИНАЧЕ СторонниеЛица.Партнер
	|	КОНЕЦ КАК Контакт,
	|	ВЫБОР
	|		КОГДА СторонниеЛица.КонтактноеЛицо ССЫЛКА Справочник.КонтактныеЛицаПартнеров
	|				И СторонниеЛица.КонтактноеЛицо <> ЗНАЧЕНИЕ(Справочник.КонтактныеЛицаПартнеров.ПустаяСсылка)
	|			ТОГДА СторонниеЛица.КонтактноеЛицо.Наименование
	|		ИНАЧЕ СторонниеЛица.Партнер.Наименование
	|	КОНЕЦ КАК Наименование,
	|	ВЫБОР
	|		КОГДА СторонниеЛица.КонтактноеЛицо ССЫЛКА Справочник.КонтактныеЛицаПартнеров
	|				И СторонниеЛица.КонтактноеЛицо <> ЗНАЧЕНИЕ(Справочник.КонтактныеЛицаПартнеров.ПустаяСсылка)
	|			ТОГДА СторонниеЛица.КонтактноеЛицо.CRM_Фамилия
	|		ИНАЧЕ СторонниеЛица.Партнер.CRM_Фамилия
	|	КОНЕЦ КАК CRM_Фамилия,
	|	ВЫБОР
	|		КОГДА СторонниеЛица.КонтактноеЛицо ССЫЛКА Справочник.КонтактныеЛицаПартнеров
	|				И СторонниеЛица.КонтактноеЛицо <> ЗНАЧЕНИЕ(Справочник.КонтактныеЛицаПартнеров.ПустаяСсылка)
	|			ТОГДА СторонниеЛица.КонтактноеЛицо.CRM_Имя
	|		ИНАЧЕ СторонниеЛица.Партнер.CRM_Имя
	|	КОНЕЦ КАК CRM_Имя,
	|	ВЫБОР
	|		КОГДА СторонниеЛица.КонтактноеЛицо ССЫЛКА Справочник.КонтактныеЛицаПартнеров
	|				И СторонниеЛица.КонтактноеЛицо <> ЗНАЧЕНИЕ(Справочник.КонтактныеЛицаПартнеров.ПустаяСсылка)
	|			ТОГДА СторонниеЛица.КонтактноеЛицо.CRM_Отчество
	|		ИНАЧЕ СторонниеЛица.Партнер.CRM_Отчество
	|	КОНЕЦ КАК CRM_Отчество,
	|	ВЫБОР
	|		КОГДА СторонниеЛица.КонтактноеЛицо ССЫЛКА Справочник.КонтактныеЛицаПартнеров
	|				И СторонниеЛица.КонтактноеЛицо <> ЗНАЧЕНИЕ(Справочник.КонтактныеЛицаПартнеров.ПустаяСсылка)
	|			ТОГДА СторонниеЛица.КонтактноеЛицо.ПометкаУдаления
	|		ИНАЧЕ СторонниеЛица.Партнер.ПометкаУдаления
	|	КОНЕЦ КАК ПометкаУдаления,
	|	ВЫБОР
	|		КОГДА СторонниеЛица.КонтактноеЛицо ССЫЛКА Справочник.КонтактныеЛицаПартнеров
	|				И СторонниеЛица.КонтактноеЛицо <> ЗНАЧЕНИЕ(Справочник.КонтактныеЛицаПартнеров.ПустаяСсылка)
	|			ТОГДА СторонниеЛица.КонтактноеЛицо.Владелец
	|		ИНАЧЕ СторонниеЛица.Партнер
	|	КОНЕЦ КАК Владелец
	|ИЗ
	|	Документ.CRM_Мероприятие.СторонниеЛица КАК СторонниеЛица
	|ГДЕ
	|	СторонниеЛица.Ссылка В(&События)
	|	И (СторонниеЛица.КонтактноеЛицо <> ЗНАЧЕНИЕ(Справочник.КонтактныеЛицаПартнеров.ПустаяСсылка)
	|				И ТИПЗНАЧЕНИЯ(СторонниеЛица.КонтактноеЛицо) <> ТИП(СТРОКА)
	|			ИЛИ СторонниеЛица.Партнер <> ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка))");
	Запрос.УстановитьПараметр("События", МассивСобытий);
	Таблица = Запрос.Выполнить().Выгрузить();
	ЗначениеВРеквизитФормы(Таблица, "КонтактыСобытий");
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТаблицуСоответствиеОбъектов(ТаблицаСинхронизируемыхОбъектов1С, ПрограммаOutlook, ПоОбъектамMSOutlook = Ложь) Экспорт
	Если ПоОбъектамMSOutlook Тогда
		МассивСсылок = Новый Массив();
		Для Каждого СтрокаТаблицы Из ТаблицаСинхронизируемыхОбъектов1С Цикл
			МассивСсылок.Добавить(СтрокаТаблицы.ОбъектOutlook.ОбъектOutlook.EntryID);
		КонецЦикла;
		ЗаполнитьТаблицуСоответствиеОбъектовСервер(МассивСсылок, ПрограммаOutlook, ПоОбъектамMSOutlook);
	Иначе
		ЗаполнитьТаблицуСоответствиеОбъектовСервер(ТаблицаСинхронизируемыхОбъектов1С, ПрограммаOutlook, ПоОбъектамMSOutlook);
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТаблицуКонтактыСобытий(События) Экспорт
	ЗаполнитьТаблицуКонтактыСобытийСервер(События);
КонецПроцедуры
