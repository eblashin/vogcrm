
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры.ЗначенияЗаполнения.Свойство("Пользователь") Тогда
		Если НЕ ЗначениеЗаполнено(Запись.Получатель) Тогда
			Запись.Пользователь = Параметры.ЗначенияЗаполнения.Пользователь;
		КонецЕсли;	
	КонецЕсли;	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Если ЗначениеЗаполнено(Запись.Пользователь)	Тогда
		Элементы.Пользователь.ТолькоПросмотр = Истина;
	Иначе
		Элементы.Пользователь.ТолькоПросмотр = Ложь;
	КонецЕсли;	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	Если НЕ ЗначениеЗаполнено(Запись.Получатель) Тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru = 'Не заполнен получатель'"), СтатусСообщения.Важное);
		Отказ = Истина;
	ИначеЕсли Запись.Получатель = Запись.Пользователь Тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru = 'Не заполнен получательи пользователь не должны совпадать'"), СтатусСообщения.Важное);
		Отказ = Истина;
	КонецЕсли;		
КонецПроцедуры

&НаКлиенте
Процедура ПолучательНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;                                                                
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("РежимВыбора", Истина);
	Если ЗначениеЗаполнено(Запись.Получатель) Тогда
		ПараметрыФормы.Вставить("ТекущаяСтрока", Запись.Получатель);
	КонецЕсли;	
	ФормаВыбора = ПолучитьФорму("Справочник.Пользователи.ФормаВыбора", ПараметрыФормы, Элемент);
	Если ЗначениеЗаполнено(Запись.Пользователь) Тогда
		ЭлементОтбора = ФормаВыбора.ПользователиСписок.Отбор.Элементы.Добавить(Тип ("ЭлементОтбораКомпоновкиДанных"));
	  	ЭлементОтбора.ЛевоеЗначение		= Новый ПолеКомпоновкиДанных("Ссылка");
		ЭлементОтбора.ВидСравнения		= ВидСравненияКомпоновкиДанных.НеРавно;
		ЭлементОтбора.ПравоеЗначение	= Запись.Пользователь;
		ЭлементОтбора.РежимОтображения	= РежимОтображенияЭлементаНастройкиКомпоновкиДанных.БыстрыйДоступ;
		ЭлементОтбора.Использование		= Истина;
	КонецЕсли;
	ФормаВыбора.Открыть();
КонецПроцедуры
