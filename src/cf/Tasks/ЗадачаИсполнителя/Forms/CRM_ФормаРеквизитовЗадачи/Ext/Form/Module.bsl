&НаСервереБезКонтекста
Функция ВернутьКонтактноеЛицо(Партнер)
	
	КонтактноеЛицо = Партнер.CRM_ОсновноеКонтактноеЛицо;
	
	Если КонтактноеЛицо = ПредопределенноеЗначение("Справочник.КонтактныеЛицаПартнеров.ПустаяСсылка") Тогда
		Возврат Неопределено;
	Иначе
		Возврат КонтактноеЛицо;
	КонецЕсли;		
	
КонецФункции


&НаКлиенте
Процедура ПартнерПриИзменении(Элемент)
	Если НЕ ЗначениеЗаполнено(КонтактноеЛицо) Тогда
		КонтактноеЛицо = ВернутьКонтактноеЛицо(Партнер);
	КонецЕсли;
КонецПроцедуры


&НаКлиенте
Процедура КонтактноеЛицоНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	Если НЕ ЗначениеЗаполнено(Партнер) Тогда 
		СтандартнаяОбработка = Ложь;
		Возврат;
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Параметрыформы = Параметры;
	Партнер = Параметрыформы.Партнер;
	КонтактноеЛицо = Параметрыформы.КонтактноеЛицо;
	Проект = Параметрыформы.Проект;
	Этап = Параметрыформы.Этап;
	ПоказатьДатуНачала = Параметрыформы.ПоказатьДатуНачала;
	ПоказатьАвтора = Параметрыформы.ПоказатьАвтора;

	
КонецПроцедуры


&НаКлиенте
Процедура ЗавершитьРедактирование(Команда)
	СтруктураПараметров = Новый Структура;
	СтруктураПараметров.Вставить("Партнер", Партнер);
	СтруктураПараметров.Вставить("КонтактноеЛицо", КонтактноеЛицо);
	СтруктураПараметров.Вставить("Проект", Проект);
	СтруктураПараметров.Вставить("Этап", Этап);
	СтруктураПараметров.Вставить("ПоказатьДатуНачала", ПоказатьДатуНачала);
	СтруктураПараметров.Вставить("ПоказатьАвтора", ПоказатьАвтора);
	Закрыть(СтруктураПараметров);
КонецПроцедуры


&НаКлиенте
Процедура ОтменаРедактирования(Команда)
	Закрыть();
КонецПроцедуры


&НаКлиенте
Процедура ЭтапНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	Если НЕ ЗначениеЗаполнено(Проект) Тогда 
		СтандартнаяОбработка = Ложь;
		Возврат;
	КонецЕсли;

КонецПроцедуры

