&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
// +CRM
	Если Объект.Ссылка.Пустая() Тогда
		Если ЗначениеЗаполнено(Параметры.ЗначениеКопирования) Тогда
			Объект.CRM_ШаблонОповещения = Параметры.ЗначениеКопирования.CRM_ШаблонОповещения;
		Иначе
			Если Параметры.Свойство("ШаблонОповещения") Тогда
				Объект.CRM_ШаблонОповещения = Параметры.ШаблонОповещения;
			Иначе
				Объект.CRM_ШаблонОповещения = Ложь;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
// -CRM
	ТаблицаАвтотекстаЗнач = РеквизитФормыВЗначение("ТаблицаАвтотекста");
	CRM_АвтотекстПереопределяемый.СформироватьСписокАвтотекста(ТаблицаАвтотекстаЗнач, Перечисления.CRM_НазначенияАвтотекста.АвтотекстСМССообщение);
	НачальныйНомер = ТаблицаАвтотекстаЗнач.Количество();
	Если Объект.CRM_ШаблонОповещения Тогда
		CRM_АвтотекстПереопределяемый.СформироватьСписокАвтотекста(ТаблицаАвтотекстаЗнач, Перечисления.CRM_НазначенияАвтотекста.АвтотекстЗадачаИсполнителя,,,НачальныйНомер);
	КонецЕсли;
	ЗначениеВРеквизитФормы(ТаблицаАвтотекстаЗнач, "ТаблицаАвтотекста");
	
	CRM_АвтотекстПереопределяемый.ЗаполнитьКоманднуюПанельСообщенияСМС(ЭтотОбъект);

КонецПроцедуры

&НаКлиенте
Процедура Подключаемый_ВставитьТэгСМС(Команда)
	
	ИмяКоманды = СтрЗаменить(Команда.Имя,"_СМС","");
	
	МассивСтрок = ТаблицаАвтотекста.НайтиСтроки(Новый Структура("ИмяКоманды",ИмяКоманды));
	Тэг = МассивСтрок[0].Тэг;
	Объект.Содержание = Объект.Содержание + " " + Тэг;
	
КонецПроцедуры
