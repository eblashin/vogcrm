
&НаСервере
Функция КартаРедактируется(ПараметрКоманды)
	
	Возврат ПараметрКоманды.Редактируется;
	
КонецФункции

&НаСервере
Функция КартаИспользоватьВИнтересах(ПараметрКоманды)
	
	Возврат ПараметрКоманды.ИспользоватьВИнтересах;
	
КонецФункции

&НаСервере
Функция КартаМаршрутаЭтоГруппа(КартаМаршрута)
	Возврат (КартаМаршрута.ЭтоГруппа);
КонецФункции

&НаСервере
Функция ЭтоНезависимыйПроцесс(КартаМаршрута)
	
	Возврат (КартаМаршрута.ТипПроцесса = Перечисления.bpmТипыПроцессов.НезависимыйПроцесс);
	
КонецФункции

&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	Если НЕ ЗначениеЗаполнено(ПараметрКоманды) ИЛИ КартаМаршрутаЭтоГруппа(ПараметрКоманды) Тогда
		Возврат;
	КонецЕсли;
	
	Если НЕ КартаРедактируется(ПараметрКоманды) Тогда
		
		Если ПараметрКоманды = ПредопределенноеЗначение("Справочник.CRM_КартыМаршрутов.ЗапросНаИзменениеСроков") Тогда
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru = 'Запуск бизнес-процесса в ручном режиме для данной карты запрещен!'"));
			Возврат;
		КонецЕсли;
		
		ПараметрыФормы = Новый Структура("Основание", ПараметрКоманды);
		
		Если CRM_БизнесПроцессыИЗадачиСервер.ЭтоПоручение(ПараметрКоманды) Тогда
			ОткрытьФорму("БизнесПроцесс.CRM_БизнесПроцесс.Форма.ФормаПоручения", ПараметрыФормы, ПараметрыВыполненияКоманды.Источник,,,,,РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
		ИначеЕсли ЭтоНезависимыйПроцесс(ПараметрКоманды) Тогда
			ОткрытьФорму("БизнесПроцесс.CRM_БизнесПроцесс.Форма.ФормаСтартаНезависимого", ПараметрыФормы, ПараметрыВыполненияКоманды.Источник,,,,,РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
		Иначе
			ОткрытьФорму("БизнесПроцесс.CRM_БизнесПроцесс.ФормаОбъекта",ПараметрыФормы, ПараметрыВыполненияКоманды.Источник);
		КонецЕсли;
	Иначе
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru = 'Карта маршрута редактируется. Старт бизнес-процесса не возможен.'"));
	КонецЕсли;
	
КонецПроцедуры
