
////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ

// Сохранение графической схемы в файл.

&НаКлиенте
// Функция сохраняет графичискую схему в файл.
//
Функция СохранитьГрафическуюСхемуВФайл()
	
	ОписаниеОповещения = Новый ОписаниеОповещения("СохранитьГрафическуюСхемуВФайлПродолжение", ЭтотОбъект);
	НачатьПодключениеРасширенияРаботыСФайлами(ОписаниеОповещения);
	
КонецФункции

&НаКлиенте
Функция СохранитьГрафическуюСхемуВФайлПродолжение(РасширениеПодключено, ДополнительныеПараметры) Экспорт
	
	Если РасширениеПодключено Тогда
	
		Расширение = "grs";
		
		// Выбираем путь к файлу на диске.
		ВыборФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Сохранение);
		ВыборФайла.МножественныйВыбор = Ложь;
		ВыборФайла.ПолноеИмяФайла = "Схема.grs";
		Фильтр = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru = 'Все файлы (*.%1)|*.%1'"), Расширение, Расширение);
		ВыборФайла.Фильтр = Фильтр;
		
		ОписаниеОповещения = Новый ОписаниеОповещения("СохранитьГрафическуюСхемуВФайлЗавершение", ЭтотОбъект);
		ВыборФайла.Показать(ОписаниеОповещения);
		
	Иначе  // веб клиент
		ПоказатьПредупреждение(, НСтр("ru = 'В Веб-клиенте без установленного расширения работы с файлами данная функция не поддерживается.'"));
	КонецЕсли;
	
КонецФункции

&НаКлиенте
Процедура СохранитьГрафическуюСхемуВФайлЗавершение(ВыбранныеФайлы, ДополнительныеПараметры) Экспорт
	Если ВыбранныеФайлы <> Неопределено Тогда
		СхемаМаршрута.НачатьЗапись(, ВыбранныеФайлы[0]);
	КонецЕсли;
КонецПроцедуры

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("Наименование") Тогда
		мНаименование = Параметры.Наименование;
	Иначе
		мНаименование = "";
	КонецЕсли;	
	Если Параметры.Свойство("СхемаМаршрута",	СхемаМаршрута) Тогда
		СхемаМаршрута = Параметры.СхемаМаршрута;
	КонецЕсли;	
	Если Параметры.Свойство("НомерВерсии",	НомерВерсии) Тогда
		НомерВерсии = Параметры.НомерВерсии;
	КонецЕсли;	
	Если Параметры.Свойство("Комментарий",	Комментарий) Тогда
		Комментарий = Параметры.Комментарий;
	КонецЕсли;	
	Если Параметры.Свойство("ДатаСоздания",	ДатаСоздания) Тогда
		ДатаСоздания = Параметры.ДатаСоздания;
	КонецЕсли;	
	Заголовок = НСтр("ru = 'Карта маршрута '") + СокрЛП(мНаименование) + НСтр("ru = ' (Версия №'") + Строка(НомерВерсии) + НСтр("ru = ' от '") + Формат(ДатаСоздания,"ДФ=dd.MM.yyyy") + ")";
	
КонецПроцедуры

#Область ПроцедурыОбработчикиСобытийКомандИЭлементовФормы

&НаКлиенте
Процедура ОК(Команда)
	Закрыть(Комментарий);
КонецПроцедуры

&НаКлиенте
Процедура СохранитьВФайл(Команда)
	
	СохранитьГрафическуюСхемуВФайл();
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти
