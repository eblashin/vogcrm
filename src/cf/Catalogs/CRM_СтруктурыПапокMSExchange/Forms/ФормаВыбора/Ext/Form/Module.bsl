
///////////////////////////////////////////////////////////////////////////////
// ОБЩИЕ ПРОЦЕДУРЫ И ФУНКЦИИ

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если	Параметры.Свойство("ТолькоПапкиОбъектов")
		И	Параметры.Свойство("Отбор")
		И	Параметры.Отбор.Свойство("СерверMSExchange")
		И	Параметры.Отбор.Свойство("УчетнаяЗапись") Тогда
		//
		Запрос = Новый Запрос("
		|ВЫБРАТЬ ПЕРВЫЕ 1
		|	СтруктурыПапокMSExchange.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.CRM_СтруктурыПапокMSExchange КАК СтруктурыПапокMSExchange
		|ГДЕ
		|	НЕ СтруктурыПапокMSExchange.ПометкаУдаления
		|	И СтруктурыПапокMSExchange.СерверMSExchange = &СерверMSExchange
		|	И СтруктурыПапокMSExchange.УчетнаяЗапись = &УчетнаяЗапись
		|	И СтруктурыПапокMSExchange.DistinguishedFolderId = &DistinguishedFolderId
		|");
		Запрос.УстановитьПараметр("СерверMSExchange", Параметры.Отбор.СерверMSExchange);
		Запрос.УстановитьПараметр("УчетнаяЗапись", Параметры.Отбор.УчетнаяЗапись);
		Запрос.УстановитьПараметр("DistinguishedFolderId", "msgfolderroot");
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
			ЭлементОтбора.ЛевоеЗначение		= Новый ПолеКомпоновкиДанных("Ссылка");
			ЭлементОтбора.ВидСравнения		= ВидСравненияКомпоновкиДанных.ВИерархии;
			ЭлементОтбора.ПравоеЗначение	= Выборка.Ссылка;
			ЭлементОтбора.Использование		= Истина;
		КонецЕсли;
	КонецЕсли;
	
	Если Параметры.Свойство("ДополнительныйОтбор") И ТипЗнч(Параметры.ДополнительныйОтбор = Тип("Массив")) Тогда
		Для Каждого СтруктураОтбор Из Параметры.ДополнительныйОтбор Цикл
			ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
			ЭлементОтбора.ЛевоеЗначение		= Новый ПолеКомпоновкиДанных(СтруктураОтбор.ЛевоеЗначение);
			ЭлементОтбора.ВидСравнения		= СтруктураОтбор.ВидСравнения;
			ЭлементОтбора.ПравоеЗначение	= СтруктураОтбор.ПравоеЗначение;
			ЭлементОтбора.Использование		= Истина;
		КонецЦикла;
	КонецЕсли;
КонецПроцедуры

#КонецОбласти
