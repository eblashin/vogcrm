#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда


Процедура УстановитьВидТочкиВОбработчиках() Экспорт
	
	// Вложенный бизнес-процесс
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ПриСозданииВложенногоБизнесПроцесса.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.ВложенныйБизнесПроцесс;
	СпрОбъект.Записать();
	
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ПослеСозданияВложенногоБизнесПроцесса.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.ВложенныйБизнесПроцесс;
	СпрОбъект.Записать();
	
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ВложенныйБизнесПроцессПередСозданиемЗадач.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.ВложенныйБизнесПроцесс;
	СпрОбъект.Записать();
	
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ВложенныйБизнесПроцессПриСозданииЗадач.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.ВложенныйБизнесПроцесс;
	СпрОбъект.Записать();
	
	// Выбор варианта
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ВыборВарианта.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.ВыборВарианта;
	СпрОбъект.Записать();
	
	// Действие
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ДействиеПриВыполнении.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.Действие;
	СпрОбъект.Записать();
	
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ДействиеПослеВыполнения.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.Действие;
	СпрОбъект.Записать();
	
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ДействиеПередСозданиемЗадач.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.Действие;
	СпрОбъект.Записать();
	
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ДействиеПриСозданииЗадач.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.Действие;
	СпрОбъект.Записать();
	
	// Завершение
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ЗавершениеПриЗавершении.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.Завершение;
	СпрОбъект.Записать();
	
	// Обработка
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.Обработка.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.Обработка;
	СпрОбъект.Записать();
	
	// Старт
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.СтартПередСтартом.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.Старт;
	СпрОбъект.Записать();
	
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.СтартПриСтарте.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.Старт;
	СпрОбъект.Записать();
	
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.СтартПослеСтарта.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.Старт;
	СпрОбъект.Записать();
	
	// Условие
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.УсловиеПроверкаУсловия.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.Условие;
	СпрОбъект.Записать();
	
	// Обработка
	СпрОбъект = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.Обработка.ПолучитьОбъект();
	СпрОбъект.ВидТочкиМаршрута = Перечисления.CRM_ВидыТочекМаршрута.Обработка;
	СпрОбъект.Записать();
	
	МассивВидов = Новый Массив;
	МассивВидов.Добавить(Перечисления.CRM_ВидыТочекМаршрута.Действие);
	МассивВидов.Добавить(Перечисления.CRM_ВидыТочекМаршрута.ВложенныйБизнесПроцесс);
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("МассивВидов",МассивВидов);
	Запрос.Текст = "ВЫБРАТЬ
	               |	CRM_ТочкиМаршрутов.Ссылка,
	               |	CRM_ТочкиМаршрутов.Вид
	               |ИЗ
	               |	Справочник.CRM_ТочкиМаршрутов КАК CRM_ТочкиМаршрутов
	               |ГДЕ
	               |	CRM_ТочкиМаршрутов.Вид В(&МассивВидов)";
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		Если Выборка.Вид = Перечисления.CRM_ВидыТочекМаршрута.Действие Тогда
			СтрокаОбработчика = Выборка.Ссылка.ОбработчикиСобытий.Найти(Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ДействиеПередСозданиемЗадач,"Событие");
		Иначе
			СтрокаОбработчика = Выборка.Ссылка.ОбработчикиСобытий.Найти(Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ВложенныйБизнесПроцессПередСозданиемЗадач,"Событие");
		КонецЕсли;
		
		Если СтрокаОбработчика = Неопределено Тогда
			Точка = Выборка.Ссылка.ПолучитьОбъект();
			НоваяСтрока = Точка.ОбработчикиСобытий.Добавить();
			Если Выборка.Вид = Перечисления.CRM_ВидыТочекМаршрута.Действие Тогда
				НоваяСтрока.Событие = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ДействиеПередСозданиемЗадач;
			Иначе
				НоваяСтрока.Событие = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ВложенныйБизнесПроцессПередСозданиемЗадач;
			КонецЕсли;
			Точка.Записать();
		КонецЕсли;
		
		Если Выборка.Вид = Перечисления.CRM_ВидыТочекМаршрута.Действие Тогда
			СтрокаОбработчика = Выборка.Ссылка.ОбработчикиСобытий.Найти(Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ДействиеПриСозданииЗадач,"Событие");
		Иначе
			СтрокаОбработчика = Выборка.Ссылка.ОбработчикиСобытий.Найти(Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ВложенныйБизнесПроцессПриСозданииЗадач,"Событие");
		КонецЕсли;
		
		Если СтрокаОбработчика = Неопределено Тогда
			Точка = Выборка.Ссылка.ПолучитьОбъект();
			НоваяСтрока = Точка.ОбработчикиСобытий.Добавить();
			Если Выборка.Вид = Перечисления.CRM_ВидыТочекМаршрута.Действие Тогда
				НоваяСтрока.Событие = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ДействиеПриСозданииЗадач;
			Иначе
				НоваяСтрока.Событие = Справочники.CRM_ОбработчикиСобытийТочекМаршрута.ВложенныйБизнесПроцессПриСозданииЗадач;
			КонецЕсли;
			Точка.Записать();
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

#КонецЕсли