
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, ТекстЗаполнения, СтандартнаяОбработка)
	
	ТипДанныхЗаполнения = ТипЗнч(ДанныеЗаполнения);
	Если ТипДанныхЗаполнения = Тип("Структура") Тогда
		ЗаполнитьЗначенияСвойств(ЭтотОбъект, ДанныеЗаполнения);
		
		// ++ Солодов В.В.
		// Подразделение по умолчанию
		Если ДанныеЗаполнения.Свойство("ЗаполнитьПодразделение") Тогда
			ДобавитьПодразделениеТекущегоПользователя();
		КонецЕсли;
		// -- Солодов В.В.
		 
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриКопировании(ОбъектКопирования)
	
	ДатаРегистрации = Неопределено;
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	
	// Начало Если ИП тогда формируем представление по серии и номеру
	// для поиска дубля.
	
	Если ОрганизационноПравоваяФорма.ЮрФизЛицо = Перечисления.ЮрФизЛицо.ИндивидуальныйПредприниматель Тогда
		ПредставлениеСерияНомер = СвидетельствоСерия + Символы.Таб + СвидетельствоНомер;
	КонецЕсли;
	
	// Конец Если ИП тогда формируем представление по серии и номеру
	// для поиска дубля.
	
	// ++ VOG Солодов В.В. 18.06.2019 task 408
	Наименование = СокрЛП(Наименование);
	// -- VOG Солодов В.В. 18.06.2019
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;	
	
	//Организация по умолчанию
	ЗначениеНастройки = CRM_ОбщегоНазначенияПовтИсп.ПолучитьЗначениеНастройки("ОсновнаяОрганизация");
	Если Организации.Количество() = 0
	  И ЗначениеЗаполнено(ЗначениеНастройки) Тогда
		Организации.Добавить().Организация = ЗначениеНастройки;	
		
	КонецЕсли;	


	Если НЕ ЗначениеЗаполнено(ДатаРегистрации) Тогда
		ДатаРегистрации = ТекущаяДатаСеанса();
	КонецЕсли;
	
	// ++ Солодов В.В.
	// Подразделение по умолчанию
	Если Подразделения.Количество() = 0 Тогда
		ДобавитьПодразделениеТекущегоПользователя();		
	КонецЕсли;
	// -- Солодов В.В.
	
	// ++ Тищенко В.В. 26.03.2019
	// Заполнить связь между юридическим лицом и торговыми точками. 
	// Для нового объекта
	//ДополнительныеСвойства.Вставить("ЗаполнитьСвязьЮридическоеЛицо",ЭтоНовый());
	// -- Тищенко В.В.
	
	// ++ VOG Солодов В.В. 10.07.2019 task 447
	Если Не Отказ И ЭтоНовый() Тогда
		
		СоответствиеРеквизитов = Новый Соответствие;
		СоответствиеРеквизитов.Вставить("CRM_ИНН", "ИНН");
		
		вогИнтеграцияСУчетнойСистемой.ПроверитьДублиКонтрагентовПоРеквизитам(ЭтотОбъект, СоответствиеРеквизитов, Отказ);
		
	КонецЕсли;
	// -- VOG Солодов В.В. 10.07.2019
	
	//START Кайдашов 29/07/19 481
	Если ЗначениеЗаполнено(СвидетельствоНомер) и ЗначениеЗаполнено(СвидетельствоСерия) тогда
		ПредставлениеСерияНомер = "серия "+СокрЛП(СвидетельствоСерия)+ " номер №" + СокрЛП(СвидетельствоНомер); 	
	КонецЕсли;
	
	//END Кайдашов
	
КонецПроцедуры

Процедура ПриЗаписи(Отказ)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;	
	
	// + Тищенко В.В.
	//Связи
	Если ДополнительныеСвойства.Свойство("ТорговыеТочкиСвязи") Тогда
		вогУправлениеСвязями.УстановитьСвязьОбъекта(Ссылка,ДополнительныеСвойства.ТорговыеТочкиСвязи);
	КонецЕсли;
	// - Тищенко В.В.
	
	// ++ Тищенко В.В. 26.03.2019
	// Заполнить связь между юридическим лицом и торговыми точками. 
	//Если ДополнительныеСвойства.ЗаполнитьСвязьЮридическоеЛицо Тогда
	//	Справочники.вогЮридическиеЛица.ЗаполнитьСвязьЮридическоеЛицоТорговаяТочка(Ссылка);
	//КонецЕсли;
	// -- Тищенко В.В. 
	
КонецПроцедуры

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	
	МассивНепроверяемыхРеквизитов = Новый Массив;
	
	КлючНастроек 		= Наименование + ОрганизационноПравоваяФорма + CRM_ИНН;
	НеПроверятьПартнер 	= ОбщегоНазначения.ХранилищеОбщихНастроекЗагрузить(КлючНастроек, "ЮрЛицоРЦ");
	
	Если НеПроверятьПартнер <> Неопределено Тогда
		
		УстановитьПривилегированныйРежим(Истина);
		ОбщегоНазначения.ХранилищеОбщихНастроекУдалить(КлючНастроек, "ЮрЛицоРЦ", Неопределено);
		УстановитьПривилегированныйРежим(Ложь);
		
		Если НеПроверятьПартнер Тогда
			МассивНепроверяемыхРеквизитов.Добавить("Партнер");
		КонецЕсли;
		
	КонецЕсли;
	
	ОбщегоНазначения.УдалитьНепроверяемыеРеквизитыИзМассива(ПроверяемыеРеквизиты, МассивНепроверяемыхРеквизитов);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// ++ Солодов В.В.
Процедура ДобавитьПодразделениеТекущегоПользователя()
	
	ПодразделениеПользователя = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(
		Пользователи.АвторизованныйПользователь(),
		"Подразделение",
		Истина);
			
	ОбособленноеПодразделение = Справочники.СтруктураПредприятия.ПолучитьОбособленноеПодразделение(
		ПодразделениеПользователя);
			
	Если ЗначениеЗаполнено(ОбособленноеПодразделение) Тогда
		НоваяСтрока = Подразделения.Добавить();
		НоваяСтрока.Подразделение = ОбособленноеПодразделение;
	КонецЕсли;
	
КонецПроцедуры
// -- Солодов В.В.

#КонецОбласти

#КонецЕсли
