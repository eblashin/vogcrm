////////////////////////////////////////////////////////////////////////////////
// КОД ПРОЦЕДУР И ФУНКЦИЙ модуля ДатыЗапретаИзмененияПереопределяемый
// для поддержки библиотечного подхода разработки.
//
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

// Вызывается из переопределяемого модуля.
Процедура НастройкаИнтерфейса(Знач НастройкиРаботыИнтерфейса) Экспорт
	НастройкиРаботыИнтерфейса.ИспользоватьВнешнихПользователей = Истина;
КонецПроцедуры

// Вызывается из переопределяемого модуля.
Процедура ЗаполнитьИсточникиДанныхДляПроверкиЗапретаИзменения(Знач ИсточникиДанных) Экспорт
	// Данные(Таблица, ПолеДаты, Раздел, ПолеОбъекта)
	ДатыЗапретаИзменения.ДобавитьСтроку(ИсточникиДанных,	"Документ.CRM_КонтрольнаяТочкаПроекта",		"Дата",	"CRM_Документы",	"Подразделение");
	ДатыЗапретаИзменения.ДобавитьСтроку(ИсточникиДанных,	"Документ.CRM_ОтчетОРаботе",				"Дата",	"CRM_Документы",	"Подразделение");
	ДатыЗапретаИзменения.ДобавитьСтроку(ИсточникиДанных,	"Документ.CRM_ПланированиеВоронкиПродаж",	"Дата",	"CRM_Документы",	"Подразделение");
	ДатыЗапретаИзменения.ДобавитьСтроку(ИсточникиДанных,	"Документ.CRM_Взаимодействие",				"Дата",	"CRM_Документы",	"Подразделение");
	ДатыЗапретаИзменения.ДобавитьСтроку(ИсточникиДанных,	"Документ.CRM_Интерес",						"Дата",	"CRM_Документы",	"Подразделение");
	ДатыЗапретаИзменения.ДобавитьСтроку(ИсточникиДанных,	"Документ.CRM_Мероприятие",					"Дата",	"CRM_Документы",	"Подразделение");
	ДатыЗапретаИзменения.ДобавитьСтроку(ИсточникиДанных,	"Документ.CRM_РассылкаЭлектронныхПисем",	"Дата",	"CRM_Документы",	"Подразделение");
	ДатыЗапретаИзменения.ДобавитьСтроку(ИсточникиДанных,	"Документ.CRM_Телемаркетинг",				"Дата",	"CRM_Документы",	"Подразделение");
	ДатыЗапретаИзменения.ДобавитьСтроку(ИсточникиДанных,	"РегистрСведений.КурсыВалют"			, 	"Период", 			 "", 	"");
	
	Если Метаданные.Имя = "CRM" Тогда
		ДатыЗапретаИзменения.ДобавитьСтроку(ИсточникиДанных,	"Документ.CRM_СчетНаОплатуПокупателю",		"Дата",	"CRM_Документы",	"Подразделение");
	КонецЕсли;
		
КонецПроцедуры

// Вызывается из переопределяемого модуля.
Процедура ПередПроверкойЗапретаИзменения(Объект,
                                         ПроверкаЗапретаИзменения,
                                         УзелПроверкиЗапретаЗагрузки,
                                         ВерсияОбъекта) Экспорт
	// При работе помощника зачета оплаты не учитывается дата запрета изменения.
	Если Объект.ДополнительныеСвойства.Свойство("ПроверкаДатыЗапретаИзменения") Тогда
		ПроверкаЗапретаИзменения = Объект.ДополнительныеСвойства.ПроверкаДатыЗапретаИзменения;
	КонецЕсли;
КонецПроцедуры

// Заполняет разделы дат запрета изменения, используемые при настройке дат запрета.
// Если не указать ни одного раздела, тогда будет доступна только настройка общей даты запрета.
//
// Параметры:
//  Разделы - ТаблицаЗначений - с колонками:
//   * Имя - Строка - имя используемое в описании источников данных в
//       процедуре ЗаполнитьИсточникиДанныхДляПроверкиЗапретаИзменения.
//
//   * Идентификатор - УникальныйИдентификатор - идентификатор ссылки элемента плана видов характеристик.
//       Чтобы получить идентификатор нужно в режиме 1С:Предприятия выполнить метод платформы:
//       "ПланыВидовХарактеристик.РазделыДатЗапретаИзменения.ПолучитьСсылку().УникальныйИдентификатор()".
//       Не следует указывать идентификаторы, полученные любым другим способом,
//       так как это может нарушить их уникальность.
//
//   * Представление - Строка - представляет раздел в форме настройки дат запрета.
//
//   * ТипыОбъектов  - Массив - типы ссылок объектов в разрезе которых можно настроить даты запрета,
//       например, Тип("СправочникСсылка.Организации"), если не указано ни одного типа,
//       то даты запрета будут настраиваться только с точностью до раздела.
//
Процедура ПриЗаполненииРазделовДатЗапретаИзменения(Разделы) Экспорт
	
	// +CRM	
	Раздел = Разделы.Добавить();
	Раздел.Имя  = "CRM_Документы";
	Раздел.Идентификатор = Новый УникальныйИдентификатор("11aafa8d-47e0-497b-83ac-887ada97e9e0");
	Раздел.Представление = НСтр("ru = 'Документы CRM'");
	Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.СтруктураПредприятия"));
	
	Если CRM_ОбщегоНазначенияПовтИсп.ЭтоCRM() Тогда
		Раздел = Разделы.Добавить();
		Раздел.Имя  = "Старые_Документы_CRM";
		Раздел.Идентификатор = Новый УникальныйИдентификатор("f0564988-8d17-4b8c-addd-7242ca11576f");
		Раздел.Представление = НСтр("ru = 'Старые документы (CRM, не используется)'");
		Раздел.ТипыОбъектов.Добавить(Тип("СправочникСсылка.СтруктураПредприятия"));
	КонецЕсли;	
	// -CRM
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#КонецОбласти
