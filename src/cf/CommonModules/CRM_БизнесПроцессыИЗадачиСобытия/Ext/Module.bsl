////////////////////////////////////////////////////////////////////////////////
// Подсистема "Бизнес-процессы и задачи".
//  
////////////////////////////////////////////////////////////////////////////////

#Область СлужебныеПроцедурыИФункции

// Обработчик подписки на событие CRM_БизнесПроцессПередЗаписью.
//
Процедура УдалитьОповещенияПриУстановкеПометкиУдаления(Источник, Отказ) Экспорт
	
	Если Источник.ОбменДанными.Загрузка Тогда 
        Возврат;  
	КонецЕсли; 
	
	Если Источник.ЭтоНовый() Тогда 
        Возврат;  
	КонецЕсли; 
	
	ПредыдущаяПометкаУдаления = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Источник.Ссылка, "ПометкаУдаления");
	Если Источник.ПометкаУдаления <> ПредыдущаяПометкаУдаления Тогда
		УстановитьПривилегированныйРежим(Истина);
		CRM_БизнесПроцессыИЗадачиСервер.УдалитьОповещенияПриУстановкеПометкиУдаления(Источник.Ссылка, Источник.ПометкаУдаления);
	КонецЕсли;	
	
	Если Источник.ПометкаУдаления Тогда
		CRM_ОповещенияСервер.УдалитьОповещения(Источник.Ссылка);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти
